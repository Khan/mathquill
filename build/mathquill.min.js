/**
 * @license
 * MathQuill v0.10.1, by Han, Jeanine, and Mary
 * http://mathquill.com | maintainers@mathquill.com
 *
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL
 * was not distributed with this file, You can obtain
 * one at http://mozilla.org/MPL/2.0/.
 */
var __extends,__assign,L,R,min,max,h,U_NO_BREAK_SPACE,U_ZERO_WIDTH_SPACE,U_DOT_ABOVE,U_NARY_SUMMATION,U_NARY_PRODUCT,U_NARY_COPRODUCT,U_INTEGRAL,animate,Aria,DOMFragment,domFrag,Point,NodeBase,Fragment,LatexCmds,CharCmds,Anticursor,Cursor,MQSelection,ControllerBase,API,EMBEDS,processedOptions,baseOptionProcessors,Options,Progenote,insistOnInterVer,MQ1,MIN,MAX,Parser,EveryTick,saneKeyboardEvents,Controller_exportText,Controller_focusBlur,INCREMENTAL_SELECTION_OPEN,MQNode,Controller_keystroke,TempSingleCharNode,latexMathParser,Controller_latex,ignoreNextMouseDownNoop,cancelSelectionOnEdit,Controller_mouse,Controller_scrollHoriz,Controller,MathElement,DOMView,MathCommand,MQSymbol,VanillaSymbol,BinaryOperator,MathBlock,RootMathBlock,DigitGroupingChar,Digit,Variable,Letter,BuiltInOpNames,TwoWordOpNames,OperatorName,fn,NonSymbolaSymbol,LatexFragment,PlusMinus,MinusNode,To,Inequality,less,greater,Greater,Equality,Sim,Approx,SVG_SYMBOLS,Style,Class,intRgx,SupSub,SubscriptCommand,SummationNotation,Fraction,LiveFraction,AnsBuilder,PercentOfBuilder,Token,SquareRoot,NthRoot,DiacriticAbove,DelimsNode,Bracket,OPP_BRACKS,BRACKET_NAMES,leftBinomialSymbol,rightBinomialSymbol,Binomial,MathFieldNode,EmbedNode,TextBlock,TextPiece,RootMathCommand,RootTextBlock;function noop(){}function walkUpAsFarAsPossible(t){for(;t;){if(!t.parent)return t;t=t.parent}}function pray(t,e,n){var r,o,i,a;if(!e){if(e=new Error("prayer failed: "+t),n)for(o in e.dcgExtraErrorMetaData=r={},n)a=n[o],i=r[o]={},a?(i.localLatex=a.latex(),(a=walkUpAsFarAsPossible(a))&&(i.rootLatex=a.latex())):i.emptyNode=!0;throw e}}function prayDirection(t){pray("a direction was passed",t===L||t===R)}function parseHTML(t){var e,n=document.implementation.createHTMLDocument("");if(n.body.innerHTML=t,1===n.body.children.length)return n.body.children[0];for(e=document.createDocumentFragment();n.body.firstChild;)e.appendChild(n.body.firstChild);return e}function closest(t,e){var n,r,o,i;if("function"==typeof(null==(n=t)?void 0:n.closest))return t.closest(e);if(t instanceof HTMLElement){o=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,i=t;do{if(o.call(i,e))return i}while(null!==(i=null!=(r=null!=(r=null==i?void 0:i.parentElement)?r:null==i?void 0:i.parentNode)?r:null)&&1===i.nodeType)}return null}function getBoundingClientRect(t){return t.getClientRects().length?t.getBoundingClientRect():{top:0,left:0,height:0,width:0,x:0,y:0,bottom:0,right:0}}function getScrollX(){return void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft}function getScrollY(){return void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}function _insDirOf(t,e,n,r){e.insertBefore(n,t===L?r:r.nextSibling)}function _insAtDirEnd(t,e,n){t===L?n.insertBefore(e,n.firstChild):n.appendChild(e)}function eachNode(t,e){var n,r=t[L];if(r&&(n=t[R]))for(n=n[R];r!==n&&!1!==e(r);r=r[R]);}function foldNodes(t,e,n){var r,o=t[L];if(o&&(r=t[R]))for(r=r[R];o!==r;o=o[R])e=n(e,o);return e}function prayWellFormed(t,e,n){pray("a parent is always present",t),pray("leftward is properly set up",e?e[R]===n&&e.parent===t:t.getEnd(L)===n,{parent:t,leftward:e,leftwardL:e&&e[L],leftwardR:e&&e[R],rightwardL:n&&n[L],rightwardR:n&&n[R]}),pray("rightward is properly set up",n?n[L]===e&&n.parent===t:t.getEnd(R)===e,{parent:t,rightward:n,leftwardL:e&&e[L],leftwardR:e&&e[R],rightwardL:n&&n[L],rightwardR:n&&n[R],rightwardParent:n&&n.parent})}function isMQNodeClass(t){return t&&t.prototype instanceof MQNode}function MathQuill(t){return insistOnInterVer(),(MQ1=MQ1||getInterface(1))(t)}function getInterface(t){var i,a,s,e,l,c,n,r,o;if(1!==t&&2!==t&&3!==t)throw"Only interface versions between "+MIN+" and "+MAX+" supported. You specified: "+t;if((i=t)<3){if(!(t=window.jQuery))throw"MathQuill interface version ".concat(i," requires jQuery 1.5.2+ to be loaded first");Options.prototype.jQuery=t}function u(t,e){var n,r,o;for(n in e)if(e.hasOwnProperty(n)){if("substituteKeyboardEvents"===n&&3<=i)throw new Error(["As of interface version 3, the 'substituteKeyboardEvents'","option is no longer supported. Use 'overrideTypedText' and","'overrideKeystroke' instead."].join(" "));r=e[n],o=a[n],t[n]=o?o(r):r}}function p(){return null!==n&&n.apply(this,arguments)||this}function d(t){var e=r.call(this)||this;return e.__controller=t,e.__options=t.options,e.id=t.id,e.data=t.data,e}function m(){return null!==o&&o.apply(this,arguments)||this}function f(r,o){function t(t,e){var n;return t&&t.nodeType?(n=c(t))instanceof o?n:((n=new Controller(new o.RootBlock,t,new s(i))).KIND_OF_MQ=r,new o(n).__mathquillify(e||{},i)):null}return pray(r+" is defined",o),t.prototype=o.prototype,t}return a=__assign(__assign({},baseOptionProcessors),{handlers:function(t){return{fns:t||{},APIClasses:l}}}),s=i<3?Options:(__extends(p,n=Options),p),__extends(d,r=Progenote),d.prototype.mathquillify=function(t){var e,n=this.__controller,r=n.root,o=n.container;n.createTextarea(),e=domFrag(o).addClass(t).children().detach(),r.setDOM(domFrag(h("span",{class:"mq-root-block","aria-hidden":!0})).appendTo(o).oneElement()),NodeBase.linkElementByBlockNode(r.domFrag().oneElement(),r),this.latex(e.text()),this.revert=function(){return n.removeMouseEventListener(),domFrag(o).removeClass("mq-editable-field mq-math-mode mq-text-mode").empty().append(e),i<3?this.__options.assertJquery()(o):o}},d.prototype.setAriaLabel=function(t){return this.__controller.setAriaLabel(t),this},d.prototype.getAriaLabel=function(){return this.__controller.getAriaLabel()},d.prototype.config=function(t){return u(this.__options,t),this},d.prototype.el=function(){return this.__controller.container},d.prototype.text=function(){return this.__controller.exportText()},d.prototype.mathspeak=function(){return this.__controller.exportMathSpeak()},d.prototype.latex=function(t){var e;return 0<arguments.length?(this.__controller.renderLatexMath(t),e=this.__controller.cursor,this.__controller.blurred&&e.hide().parent.blur(e),this):this.__controller.exportLatex()},d.prototype.selection=function(){return this.__controller.exportLatexSelection()},d.prototype.html=function(){return this.__controller.root.domFrag().oneElement().innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},d.prototype.reflow=function(){return this.__controller.root.postOrder(function(t){t.reflow()}),this},d.prototype.cursor=function(){return this.__controller.cursor},d.prototype.controller=function(){return this.__controller},__extends(m,o=t=d),m.prototype.mathquillify=function(t){return o.prototype.mathquillify.call(this,t),this.__controller.editable=!0,this.__controller.addMouseEventListener(),this.__controller.editablesTextareaEvents(),this},m.prototype.focus=function(){return this.__controller.getTextareaOrThrow().focus(),this.__controller.scrollHoriz(),this},m.prototype.blur=function(){return this.__controller.getTextareaOrThrow().blur(),this},m.prototype.write=function(t){this.__controller.writeLatex(t),this.__controller.scrollHoriz();t=this.__controller.cursor;return this.__controller.blurred&&t.hide().parent.blur(t),this},m.prototype.empty=function(){var t,e=this.__controller.root,n=this.__controller.cursor;return e.setEnds(((t={})[L]=0,t[R]=0,t)),e.domFrag().empty(),delete n.selection,n.insAtRightEnd(e),this},m.prototype.cmd=function(t){var e,n=this.__controller.notify(void 0),r=n.cursor;return/^\\[a-z]+$/i.test(t)&&!r.isTooDeep()?(t=t.slice(1),(e=LatexCmds[t])&&(e=e.constructor?new e(t):e(t),r.selection&&e.replaces(r.replaceSelection()),e.createLeftOf(r.show()))):r.parent.write(r,t),n.scrollHoriz(),n.blurred&&r.hide().parent.blur(r),this},m.prototype.select=function(){return this.__controller.selectAll(),this},m.prototype.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},m.prototype.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},m.prototype.moveToLeftEnd=function(){return this.moveToDirEnd(L)},m.prototype.moveToRightEnd=function(){return this.moveToDirEnd(R)},m.prototype.keystroke=function(t,e){for(var n=t.replace(/^\s+|\s+$/g,"").split(/\s+/),r=0;r<n.length;r+=1)this.__controller.keystroke(n[r],e);return this},m.prototype.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},m.prototype.dropEmbedded=function(t,e,n){var t=t-getScrollX(),e=e-getScrollY(),r=document.elementFromPoint(t,e);this.__controller.seek(r,t,e),(new EmbedNode).setOptions(n).createLeftOf(this.__controller.cursor)},m.prototype.setAriaPostLabel=function(t,e){return this.__controller.setAriaPostLabel(t,e),this},m.prototype.getAriaPostLabel=function(){return this.__controller.getAriaPostLabel()},m.prototype.clickAt=function(t,e,n){var r,o;return n=n||document.elementFromPoint(t,e),(o=(r=this.__controller).root.domFrag().oneElement()).contains(n)||(n=o),r.seek(n,t,e),r.blurred&&this.focus(),this},m.prototype.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this},l={AbstractMathQuill:t,EditableField:e=m},pray("API.StaticMath defined",API.StaticMath),l.StaticMath=API.StaticMath(l),pray("API.MathField defined",API.MathField),l.MathField=API.MathField(l),pray("API.InnerMathField defined",API.InnerMathField),l.InnerMathField=API.InnerMathField(l),API.TextField&&(l.TextField=API.TextField(l)),(c=function(t){var e,n,r,o,i;if(!t||!t.nodeType)return null;for(n=0,r=domFrag(t).children().toElementArray();n<r.length;n++)if((o=r[n]).classList.contains("mq-root-block")){e=o;break}return i=(t=(t=NodeBase.getNodeOfElement(e))&&t.controller)&&l[t.KIND_OF_MQ],t&&i?new i(t):null}).L=L,c.R=R,c.config=function(t){return u(s.prototype,t),this},c.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";EMBEDS[t]=e},c.StaticMath=f("StaticMath",l.StaticMath),c.MathField=f("MathField",l.MathField),c.InnerMathField=f("InnerMathField",l.InnerMathField),l.TextField&&(c.TextField=f("TextField",l.TextField)),c.prototype=t.prototype,(c.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"}).prototype=e.prototype,i<3&&(c.saneKeyboardEvents=defaultSubstituteKeyboardEvents),c}function RootBlockMixin(t){t.moveOutOf=function(t){pray("controller is defined",this.controller),this.controller.handle("moveOutOf",t)},t.deleteOutOf=function(t){pray("controller is defined",this.controller),this.controller.handle("deleteOutOf",t)},t.selectOutOf=function(t){pray("controller is defined",this.controller),this.controller.handle("selectOutOf",t)},t.upOutOf=function(){pray("controller is defined",this.controller),this.controller.handle("upOutOf")},t.downOutOf=function(){pray("controller is defined",this.controller),this.controller.handle("downOutOf")},t.reflow=function(){pray("controller is defined",this.controller),this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function parseError(t,e){throw"Parse Error: "+e+" at "+(t=t?"'"+t+"'":"EOF")}function defaultSubstituteKeyboardEvents(t,e){return saneKeyboardEvents(t[0],e)}function bindVanillaSymbol(t,e,n){return function(){return new VanillaSymbol(t,e?h.entityText(e):void 0,n)}}function bindBinaryOperator(t,e,n,r){return function(){return new BinaryOperator(t,e?h.entityText(e):void 0,n,r)}}function bindVariable(t,e,n){return function(){return new Variable(t,h.entityText(e))}}function defaultAutoOpNames(){for(var t,e,n,r={_maxLength:9},o="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),i=0;i<o.length;i+=1)BuiltInOpNames[o[i]]=r[o[i]]=1;for(t="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),i=0;i<t.length;i+=1)BuiltInOpNames[t[i]]=1;for(e="sin cos tan sec cosec csc cotan cot ctg".split(" "),i=0;i<e.length;i+=1)r[e[i]]=r["arc"+e[i]]=r[e[i]+"h"]=r["ar"+e[i]+"h"]=r["arc"+e[i]+"h"]=1;for(n="gcf hcf lcm proj span".split(" "),i=0;i<n.length;i+=1)r[n[i]]=1;return r}for(fn in __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n,r=1,o=arguments.length;r<o;r++)for(n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},L=-1,R=1,min=Math.min,max=Math.max,(h=function(t,e,n){var r,o,i,a;switch(t){case"svg":case"path":r=document.createElementNS("http://www.w3.org/2000/svg",t);break;default:r=document.createElement(t)}for(o in e)void 0!==(i=e[o])&&r.setAttribute(o,"string"==typeof i?i:String(i));if(n)for(a=0;a<n.length;a++)r.appendChild(n[a]);return r}).text=function(t){return document.createTextNode(t)},h.block=function(t,e,n){t=h(t,e,[n.html()]);return n.setDOM(t),NodeBase.linkElementByBlockNode(t,n),t},h.entityText=function(t){t=parseHTML(t);return pray("entity parses to a single text node",t instanceof DocumentFragment&&1===t.childNodes.length&&t.childNodes[0]instanceof Text),t.childNodes[0]},U_NO_BREAK_SPACE=" ",U_ZERO_WIDTH_SPACE="​",U_DOT_ABOVE="˙",U_NARY_SUMMATION="∑",U_NARY_PRODUCT="∏",U_NARY_COPRODUCT="∐",U_INTEGRAL="∫",animate=function(){var l,c="function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(l=requestAnimationFrame,cancelAnimationFrame):(l=function(t){return setTimeout(t,13)},clearTimeout);return function(e,n){var r,t,o;function i(){var t=(Date.now()-r)/e;t<=o?s():o=t,n(o,s,a)}function a(){void 0!==t&&c(t),t=void 0}function s(){a(),t=l(i)}r=Date.now(),n(e<=(o=0)?1:0,s,a)}}(),Aria=function(){function t(t){this.span=h("span",{class:"mq-aria-alert","aria-live":"assertive","aria-atomic":"true"}),this.msg="",this.items=[],this.controller=t}return t.prototype.attach=function(){var t=this.controller.container;this.span.parentNode!==t&&domFrag(t).prepend(domFrag(this.span))},t.prototype.queue=function(t,e){var n,r;return void 0===e&&(e=!1),n="",t instanceof MQNode?(r=t.mathspeak({ignoreShorthand:!0}),e&&(t.parent&&t.parent.ariaLabel&&"block"===t.ariaLabel?n=t.parent.ariaLabel+" "+r:t.ariaLabel&&(n=t.ariaLabel+" "+r)),""===n&&(n=r)):n=t||"",this.items.push(n),this},t.prototype.queueDirOf=function(t){return prayDirection(t),this.queue(t===L?"before":"after")},t.prototype.queueDirEndOf=function(t){return prayDirection(t),this.queue(t===L?"beginning of":"end of")},t.prototype.alert=function(t){return this.attach(),t&&this.queue(t),this.items.length&&(this.msg=this.items.join(" ").replace(/ +(?= )/g,"").trim(),this.controller.containerHasFocus())&&(this.controller.options.logAriaAlerts&&this.msg&&console.log(this.msg),this.span.textContent=this.msg),this.clear()},t.prototype.clear=function(){return this.items.length=0,this},t}(),DOMFragment=function(){function r(t,e){var n;1===arguments.length&&(e=t),t&&e&&(this.ends=((n={})[L]=t,n[R]=e,n))}return r.create=function(t,e){pray("No half-empty DOMFragments",!!t==!!(e=1===arguments.length?t:e));var n=new r(t,e);return pray("last is a forward sibling of first",n.isValid()),n},r.prototype.isEmpty=function(){return void 0===this.ends},r.prototype.isOneNode=function(){return!(!this.ends||this.ends[L]!==this.ends[R])},r.prototype.isValid=function(){var e;return!this.ends||this.ends[L]===this.ends[R]||(this.eachNode(function(t){return e=t}),e===this.ends[R])},r.prototype.firstNode=function(){return pray("Fragment is not empty",this.ends),this.ends[L]},r.prototype.lastNode=function(){return pray("Fragment is not empty",this.ends),this.ends[R]},r.prototype.children=function(){var t=this.oneNode(),e=t.firstChild,t=t.lastChild;return e&&t?new r(e,t):new r},r.prototype.join=function(t){var e,n;if(!this.ends)return t;if(!t.ends)return this;for(e=!1,n=this.ends[R].nextSibling;n;){if(n===t.ends[L]){e=!0;break}n=n.nextSibling}return pray("sibling must be a forward DOM sibling of this fragment",e),new r(this.ends[L],t.ends[R])},r.prototype.oneNode=function(){return pray("Fragment has a single node",this.ends&&this.ends[L]===this.ends[R]),this.ends[L]},r.prototype.oneElement=function(){var t=this.oneNode();return pray("Node is an Element",t.nodeType===Node.ELEMENT_NODE),t},r.prototype.oneText=function(){var t=this.oneNode();return pray("Node is Text",t.nodeType===Node.TEXT_NODE),t},r.prototype.eachNode=function(t){var e,n,r;if(this.ends)for(e=this.ends[R],n=this.ends[L],r=void 0;n&&(r=n.nextSibling,t(n),n!==e);n=r);return this},r.prototype.eachElement=function(e){return this.eachNode(function(t){t.nodeType===Node.ELEMENT_NODE&&e(t)}),this},r.prototype.text=function(){var e="";return this.eachNode(function(t){e+=t.textContent||""}),e},r.prototype.toNodeArray=function(){var e=[];return this.eachNode(function(t){return e.push(t)}),e},r.prototype.toElementArray=function(){var e=[];return this.eachElement(function(t){return e.push(t)}),e},r.prototype.toDocumentFragment=function(){var e=document.createDocumentFragment();return this.eachNode(function(t){return e.appendChild(t)}),e},r.prototype.insertBefore=function(t){return this.insDirOf(L,t)},r.prototype.insertAfter=function(t){return this.insDirOf(R,t)},r.prototype.append=function(t){return t.appendTo(this.oneElement()),this},r.prototype.prepend=function(t){return t.prependTo(this.oneElement()),this},r.prototype.appendTo=function(t){return this.insAtDirEnd(R,t)},r.prototype.prependTo=function(t){return this.insAtDirEnd(L,t)},r.prototype.parent=function(){var t;return this.ends?(t=this.ends[L].parentNode)?new r(t):new r:this},r.prototype.wrapAll=function(t){var e,n;return t.textContent="",this.ends&&(e=this.ends[L].parentNode,n=this.ends[R].nextSibling,this.appendTo(t),e)&&e.insertBefore(t,n),this},r.prototype.replaceWith=function(t){var e=null==(e=this.ends)?void 0:e[R],n=null==e?void 0:e.parentNode,r=null==e?void 0:e.nextSibling;return this.detach(),t=t.toDocumentFragment(),e&&n&&n.insertBefore(t,r||null),this},r.prototype.nthElement=function(t){if(this.ends&&!(t<0||t!==Math.floor(t)))for(var e=this.ends[L];e;){if(e.nodeType===Node.ELEMENT_NODE){if(t<=0)return e;--t}if(e===this.ends[R])return;e=e.nextSibling}},r.prototype.firstElement=function(){return this.nthElement(0)},r.prototype.lastElement=function(){if(this.ends)for(var t=this.ends[R];t;){if(t.nodeType===Node.ELEMENT_NODE)return t;if(t===this.ends[L])return;t=t.previousSibling}},r.prototype.first=function(){return new r(this.firstElement())},r.prototype.last=function(){return new r(this.lastElement())},r.prototype.eq=function(t){return new r(this.nthElement(t))},r.prototype.slice=function(t){return this.ends?(t=this.nthElement(t))?new r(t,this.ends[R]):new r:this},r.prototype.next=function(){for(var t=this.oneNode();t;)if((t=t.nextSibling)&&t.nodeType===Node.ELEMENT_NODE)return new r(t);return new r},r.prototype.prev=function(){for(var t=this.oneNode();t;)if((t=t.previousSibling)&&t.nodeType===Node.ELEMENT_NODE)return new r(t);return new r},r.prototype.empty=function(){return this.eachElement(function(t){t.textContent=""}),this},r.prototype.remove=function(){return this.toDocumentFragment(),this},r.prototype.detach=function(){return this.remove()},r.prototype.insDirOf=function(t,e){if(this.ends){if(!(e=null==(e=e.ends)?void 0:e[t])||!e.parentNode)return this.detach();_insDirOf(t,e.parentNode,this.toDocumentFragment(),e)}return this},r.prototype.insAtDirEnd=function(t,e){return this.ends&&_insAtDirEnd(t,this.toDocumentFragment(),e),this},r.prototype.hasClass=function(e){var n=!1;return this.eachElement(function(t){t.classList.contains(e)&&(n=!0)}),n},r.prototype.addClass=function(t){for(var e=function(e){if(!e)return"continue";n.eachElement(function(t){t.classList.add(e)})},n=this,r=0,o=t.split(/\s+/);r<o.length;r++)e(o[r]);return this},r.prototype.removeClass=function(t){for(var e=function(e){if(!e)return"continue";n.eachElement(function(t){t.classList.remove(e)})},n=this,r=0,o=t.split(/\s+/);r<o.length;r++)e(o[r]);return this},r.prototype.toggleClass=function(t,e){var n,r,o,i;if(!0===e)return this.addClass(t);if(!1===e)return this.removeClass(t);for(n=function(e){if(!e)return"continue";r.eachElement(function(t){t.classList.toggle(e)})},r=this,o=0,i=t.split(/\s+/);o<i.length;o++)n(i[o]);return this},r}(),domFrag=DOMFragment.create,Point=function(){function e(t,e,n){this.init(t,e,n)}return e.prototype.init=function(t,e,n){this.parent=t,this[L]=e,this[R]=n},e.copy=function(t){return new e(t.parent,t[L],t[R])},e}(),NodeBase=function(){function e(){var t;this[n]=0,this[r]=0,this.parent=0,this.ends=((t={})[L]=0,t[R]=0,t),this.id=e.uniqueNodeId()}var n,r;return e.uniqueNodeId=function(){return e.idCounter+=1},e.getNodeOfElement=function(t){if(t){if(t.nodeType)return t.mqBlockNode||t.mqCmdNode;throw new Error("must pass an Element to NodeBase.getNodeOfElement")}},e.linkElementByBlockNode=function(t,e){t.mqBlockNode=e},e.linkElementByCmdNode=function(t,e){t.mqCmdNode=e},e.prototype.setEnds=function(t){this.ends=t,pray("No half-empty node ends",!!this.ends[L]==!!this.ends[R])},e.prototype.getEnd=function(t){return this.ends[t]},e.prototype.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},e.prototype.setDOM=function(t){return t&&pray("DOM is an element or a text node",t.nodeType===Node.ELEMENT_NODE||t.nodeType===Node.TEXT_NODE),this._el=t,this},e.prototype.domFrag=function(){return domFrag(this._el)},e.prototype.createDir=function(t,e){prayDirection(t);return this.html(),this.domFrag().insDirOf(t,e.domFrag()),e[t]=this.adopt(e.parent,e[L],e[R]),this},e.prototype.createLeftOf=function(t){this.createDir(L,t)},e.prototype.selectChildren=function(t,e){return new MQSelection(t,e)},e.prototype.bubble=function(t){for(var e=this.getSelfNode();e&&!1!==t(e);e=e.parent);return this},e.prototype.postOrder=function(n){var t=this.getSelfNode();return function t(e){return!!e&&(e.eachChild(t),n(e),!0)}(t),t},e.prototype.isEmpty=function(){return 0===this.ends[L]&&0===this.ends[R]},e.prototype.isQuietEmptyDelimiter=function(t){var e;return!!this.isEmpty()&&!!t&&!(!this.parent||void 0===this.parent.ctrlSeq)&&(e=this.parent.ctrlSeq.replace(/^\\(left|right)?/,""),t.hasOwnProperty(e))},e.prototype.isStyleBlock=function(){return!1},e.prototype.isTextBlock=function(){return!1},e.prototype.children=function(){return new Fragment(this.getEnd(L),this.getEnd(R))},e.prototype.eachChild=function(t){return eachNode(this.ends,t),this},e.prototype.foldChildren=function(t,e){return foldNodes(this.ends,t,e)},e.prototype.withDirAdopt=function(t,e,n,r){var o=this.getSelfNode();return new Fragment(o,o).withDirAdopt(t,e,n,r),this},e.prototype.adopt=function(t,e,n){var r=this.getSelfNode();return new Fragment(r,r).adopt(t,e,n),this.getSelfNode()},e.prototype.disown=function(){var t=this.getSelfNode();return new Fragment(t,t).disown(),this},e.prototype.remove=function(){return this.domFrag().remove(),this.disown()},e.prototype.shouldIgnoreSubstitutionInSimpleSubscript=function(t){return!!t.disableAutoSubstitutionInSubscripts&&!!this.parent&&this.parent.parent instanceof SupSub&&!!this.parent.domFrag().hasClass("mq-sub")},e.prototype.getSelfNode=function(){return this},e.prototype.parser=function(){pray("Abstract parser() method is never called",!1)},e.prototype.html=function(){throw new Error("html() unimplemented in NodeBase")},e.prototype.text=function(){return""},e.prototype.latex=function(){var t={latex:"",startIndex:-1,endIndex:-1};return this.latexRecursive(t),t.latex},e.prototype.latexRecursive=function(t){},e.prototype.checkCursorContextOpen=function(t){t.startSelectionBefore===this&&(t.startIndex=t.latex.length),t.endSelectionBefore===this&&(t.endIndex=t.latex.length)},e.prototype.checkCursorContextClose=function(t){t.startSelectionAfter===this&&(t.startIndex=t.latex.length),t.endSelectionAfter===this&&(t.endIndex=t.latex.length)},e.prototype.finalizeTree=function(t,e){},e.prototype.contactWeld=function(t,e){},e.prototype.blur=function(t){},e.prototype.focus=function(){},e.prototype.intentionalBlur=function(){},e.prototype.reflow=function(){},e.prototype.registerInnerField=function(t,e){},e.prototype.chToCmd=function(t,e){pray("Abstract chToCmd() method is never called",!1)},e.prototype.mathspeak=function(t){return""},e.prototype.seek=function(t,e){},e.prototype.siblingDeleted=function(t,e){},e.prototype.siblingCreated=function(t,e){},e.prototype.finalizeInsert=function(t,e){},e.prototype.fixDigitGrouping=function(t){},e.prototype.writeLatex=function(t,e){},e.prototype.write=function(t,e){},n=L,r=R,e.idCounter=0,e}(),Fragment=function(){function t(t,e,n){var r,o;this.disowned=!1,prayDirection(n=void 0===n?L:n),pray("no half-empty fragments",!t==!e,{withDir:t,oppDir:e}),t&&e?(pray("withDir is passed to Fragment",t instanceof MQNode),pray("oppDir is passed to Fragment",e instanceof MQNode),pray("withDir and oppDir have the same parent",t.parent===e.parent),(r={})[n]=t,r[-n]=e,t=r,this.setEnds(t),o=0,this.each(function(t){o=t}),pray("following direction siblings from start reaches end",o===t[R])):this.setEnds(((n={})[L]=0,n[R]=0,n))}return t.prototype.getDOMFragFromEnds=function(){var t=this.ends[L],e=this.ends[R];return 0===t||0===e?domFrag():t===e?t.domFrag():t.domFrag().join(e.domFrag())},t.prototype.setEnds=function(t){this.ends=t},t.prototype.getEnd=function(t){return this.ends?this.ends[t]:0},t.prototype.domFrag=function(){return this.getDOMFragFromEnds()},t.prototype.withDirAdopt=function(t,e,n,r){return t===L?this.adopt(e,n,r):this.adopt(e,r,n)},t.prototype.adopt=function(e,n,t){var r,o,i;return prayWellFormed(e,n,t),this.disowned=!1,(r=this.ends[L])&&(o=this.ends[R])&&((i={})[L]=e.getEnd(L),i[R]=e.getEnd(R),i=i,n||(i[L]=r),t?t[L]=o:i[R]=o,e.setEnds(i),o[R]=t,this.each(function(t){return t[L]=n,t.parent=e,n&&(n[R]=t),n=t,!0})),this},t.prototype.disown=function(){var t,e,n,r=this,o=r.ends[L];return o&&!r.disowned&&(this.disowned=!0,t=r.ends[R])&&(prayWellFormed(e=o.parent,o[L],o),prayWellFormed(e,t,t[R]),(n={})[L]=e.getEnd(L),n[R]=e.getEnd(R),n=n,o[L]?o[L][R]=t[R]:n[L]=t[R],t[R]?t[R][L]=o[L]:n[R]=o[L],n[L]&&n[R]?e.setEnds(n):e.ends=n),r},t.prototype.remove=function(){return this.domFrag().remove(),this.disown()},t.prototype.each=function(t){return eachNode(this.ends,t),this},t.prototype.fold=function(t,e){return foldNodes(this.ends,t,e)},t}(),LatexCmds={},CharCmds={},Anticursor=function(r){function e(t,e,n){t=r.call(this,t,e,n)||this;return t.ancestors={},t}return __extends(e,r),e.fromCursor=function(t){return new e(t.parent,t[L],t[R])},e}(Point),Cursor=function(o){function t(t,e,n){var r=o.call(this,t,0,0)||this;return r.upDownCache={},r.cursorElement=h("span",{class:"mq-cursor"},[h.text(U_ZERO_WIDTH_SPACE)]),r._domFrag=domFrag(),r.controller=n,r.options=e,r.setDOMFrag(domFrag(r.cursorElement)),r.blink=function(){domFrag(r.cursorElement).toggleClass("mq-blink")},r}return __extends(t,o),t.prototype.setDOMFrag=function(t){return this._domFrag=t,this},t.prototype.domFrag=function(){return this._domFrag},t.prototype.show=function(){var t,e;return domFrag(this.cursorElement).removeClass("mq-blink"),this.setDOMFrag(domFrag(this.cursorElement)),this.intervalId?clearInterval(this.intervalId):((t=this[R])?(e=this.selection)&&e.getEnd(L)[L]===this[L]?this.domFrag().insertBefore(e.domFrag()):this.domFrag().insertBefore(t.domFrag()):this.domFrag().appendTo(this.parent.domFrag().oneElement()),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.prototype.hide=function(){return this.intervalId&&clearInterval(this.intervalId),this.intervalId=0,this.domFrag().detach(),this.setDOMFrag(domFrag()),this},t.prototype.withDirInsertAt=function(t,e,n,r){var o=this.parent;this.parent=e,this[t]=n,this[-t]=r,o!==e&&o.blur&&o.blur(this)},t.prototype.insDirOf=function(t,e){return prayDirection(t),this.domFrag().insDirOf(t,e.domFrag()),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.domFrag().addClass("mq-hasCursor"),this},t.prototype.insLeftOf=function(t){return this.insDirOf(L,t)},t.prototype.insRightOf=function(t){return this.insDirOf(R,t)},t.prototype.insAtDirEnd=function(t,e){return prayDirection(t),this.domFrag().insAtDirEnd(t,e.domFrag().oneElement()),this.withDirInsertAt(t,e,0,e.getEnd(t)),e.focus(),this},t.prototype.insAtLeftEnd=function(t){return this.insAtDirEnd(L,t)},t.prototype.insAtRightEnd=function(t){return this.insAtDirEnd(R,t)},t.prototype.jumpUpDown=function(t,e){var n,r=this;r.upDownCache[t.id]=Point.copy(r),(t=r.upDownCache[e.id])?(n=t[R])?r.insLeftOf(n):r.insAtRightEnd(t.parent):(n=r.getBoundingClientRectWithoutMargin().left,e.seek(n,r)),r.controller.aria.queue(e,!0)},t.prototype.getBoundingClientRectWithoutMargin=function(){var t,e,n=this.domFrag();return n.removeClass("mq-cursor"),t=(e=getBoundingClientRect(n.oneElement())).left,e=e.right,n.addClass("mq-cursor"),{left:t,right:e}},t.prototype.unwrapGramp=function(){var t,e,n,r=this.parent.parent,o=r.parent,i=r[R],a=r[L];if(r.disown().eachChild(function(t){return t.isEmpty()||(t.children().adopt(o,a,i).each(function(t){return t.domFrag().insertBefore(r.domFrag()),!0}),a=t.getEnd(R)),!0}),!this[R])if(e=this[L])this[R]=e[R];else for(;!this[R];){if(!(t=this.parent[R])){this[R]=r[R],this.parent=o;break}this.parent=t,this[R]=t.getEnd(L)}(e=this[R])?this.insLeftOf(e):this.insAtRightEnd(o),r.domFrag().remove(),e=r[L],n=r[R],e&&e.siblingDeleted(this.options,R),n&&n.siblingDeleted(this.options,L)},t.prototype.startSelection=function(){for(var t=this.anticursor=Anticursor.fromCursor(this),e=t.ancestors,n=t;n.parent;n=n.parent)e[n.parent.id]=n},t.prototype.endSelection=function(){delete this.anticursor},t.prototype.select=function(){var t,e,n,r,o,i,a,s,l=this.anticursor;if(this[L]===l[L]&&this.parent===l.parent)return!1;for(e=this;e.parent;e=e.parent)if(e.parent.id in l.ancestors){t=e.parent;break}if(pray("cursor and anticursor in the same tree",t),s=t,n=l.ancestors[s.id],i=R,e[L]!==n)for(a=e;a;a=a[R])if(a[R]===n[R]){i=L,r=e,o=n;break}return i===R&&(r=n,o=e),r instanceof Point&&(r=r[R]),o instanceof Point&&(o=o[L]),this.hide().selection=s.selectChildren(r,o),s=this.selection.getEnd(i),this.insDirOf(i,s),this.selectionChanged(),!0},t.prototype.resetToEnd=function(t){this.clearSelection();t=t.root;this[R]=0,this[L]=t.getEnd(R),this.parent=t},t.prototype.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.prototype.deleteSelection=function(){var t=this.selection;t&&(this[L]=t.getEnd(L)[L],this[R]=t.getEnd(R)[R],t.remove(),this.selectionChanged(),delete this.selection)},t.prototype.replaceSelection=function(){var t=this.selection;return t&&(this[L]=t.getEnd(L)[L],this[R]=t.getEnd(R)[R],delete this.selection),t},t.prototype.depth=function(){for(var t=this,e=0;t=t.parent;)e+=t instanceof MathBlock?1:0;return e},t.prototype.isTooDeep=function(t){return void 0!==this.options.maxDepth&&this.depth()+(t||0)>this.options.maxDepth},t.prototype.selectionChanged=function(){},t}(Point),MQSelection=function(r){function t(t,e,n){t=r.call(this,t,e,n)||this;return t._el=h("span",{class:"mq-selection"}),t.getDOMFragFromEnds().wrapAll(t._el),t}return __extends(t,r),t.prototype.isCleared=function(){return void 0===this._el},t.prototype.domFrag=function(){return this.isCleared()?this.getDOMFragFromEnds():domFrag(this._el)},t.prototype.setEnds=function(t){pray("Selection ends are never empty",t[L]&&t[R]),this.ends=t},t.prototype.getEnd=function(t){return this.ends[t]},t.prototype.adopt=function(t,e,n){return this.clear(),r.prototype.adopt.call(this,t,e,n)},t.prototype.clear=function(){var t=this.getDOMFragFromEnds();return this.domFrag().replaceWith(t),this._el=void 0,this},t.prototype.join=function(n,r){return void 0===r&&(r=""),this.fold("",function(t,e){return t+r+e[n]()})},t}(Fragment),ControllerBase=function(){function n(t,e,n){this.textareaEventListeners={},this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,this.aria=new Aria(this.getControllerSelf()),this.ariaLabel="Math Input",this.ariaPostLabel="",t.controller=this.getControllerSelf(),this.cursor=t.cursor=new Cursor(t,n,this.getControllerSelf())}return n.prototype.getControllerSelf=function(){return this},n.prototype.handle=function(t,e){var n=this.options.handlers,r=null==(r=this.options.handlers)?void 0:r.fns[t];r&&(pray("APIClass is defined",t=null==n?void 0:n.APIClasses[this.KIND_OF_MQ]),n=new t(this),e===L||e===R?r(e,n):r(n))},n.onNotify=function(t){n.notifyees.push(t)},n.prototype.notify=function(t){for(var e=0;e<n.notifyees.length;e+=1)n.notifyees[e](this.cursor,t);return this},n.prototype.setAriaLabel=function(t){var e=this.getAriaLabel();return t&&"string"==typeof t&&""!==t?this.ariaLabel=t:this.editable?this.ariaLabel="Math Input":this.ariaLabel="",this.ariaLabel===e||this.containerHasFocus()||this.updateMathspeak(),this},n.prototype.getAriaLabel=function(){return"Math Input"!==this.ariaLabel?this.ariaLabel:this.editable?"Math Input":""},n.prototype.setAriaPostLabel=function(t,e){var n=this;return t&&"string"==typeof t&&""!==t?(t!==this.ariaPostLabel&&"number"==typeof e&&(this._ariaAlertTimeout&&clearTimeout(this._ariaAlertTimeout),this._ariaAlertTimeout=setTimeout(function(){n.containerHasFocus()?n.aria.alert(n.root.mathspeak().trim()+" "+t.trim()):n.updateMathspeak()},e)),this.ariaPostLabel=t):(this._ariaAlertTimeout&&clearTimeout(this._ariaAlertTimeout),this.ariaPostLabel=""),this},n.prototype.getAriaPostLabel=function(){return this.ariaPostLabel||""},n.prototype.containerHasFocus=function(){return document.activeElement&&this.container.contains(document.activeElement)},n.prototype.getTextareaOrThrow=function(){var t=this.textarea;if(t)return t;throw new Error("expected a textarea")},n.prototype.getTextareaSpanOrThrow=function(){var t=this.textareaSpan;if(t)return t;throw new Error("expected a textareaSpan")},n.prototype.addTextareaEventListeners=function(t){var e,n;if(this.textarea)for(e in t)n=e,this.removeTextareaEventListener(n),this.textarea.addEventListener(n,t[n])},n.prototype.removeTextareaEventListener=function(t){var e;this.textarea&&(e=this.textareaEventListeners[t])&&this.textarea.removeEventListener(t,e)},n.prototype.exportMathSpeak=function(){return this.root.mathspeak()},n.prototype.updateMathspeak=function(){},n.prototype.scrollHoriz=function(){},n.prototype.selectionChanged=function(){},n.prototype.setOverflowClasses=function(){},n.notifyees=[],n}(),API={},EMBEDS={},processedOptions={handlers:!0,autoCommands:!0,quietEmptyDelimiters:!0,autoParenthesizedFunctions:!0,autoOperatorNames:!0,leftRightIntoCmdGoes:!0,maxDepth:!0,interpretTildeAsSim:!0},baseOptionProcessors={},Options=function(){function t(t){this.version=t}return t.prototype.assertJquery=function(){return pray("Interface versions > 2 do not depend on JQuery",this.version<=2),pray("JQuery is set for interface v < 3",this.jQuery),this.jQuery},t}(),Progenote=function(){},insistOnInterVer=function(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},MathQuill.prototype=Progenote.prototype,MathQuill.VERSION="v0.10.1",MathQuill.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return(insistOnInterVer=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')})(),MathQuill},MathQuill.getInterface=getInterface,MIN=getInterface.MIN=1,MAX=getInterface.MAX=3,Parser=function(){function s(t){this._=t}return s.prototype.parse=function(t){return this.skip(s.eof)._(""+t,function(t,e){return e},parseError)},s.prototype.or=function(o){pray("or is passed a parser",o instanceof s);var t=this;return new s(function(e,n,r){return t._(e,n,function(t){return o._(e,n,r)})})},s.prototype.then=function(o){var e=this;return new s(function(t,n,r){return e._(t,function(t,e){e=o instanceof s?o:o(e);return pray("a parser is returned",e instanceof s),e._(t,n,r)},r)})},s.prototype.many=function(){var a=this;return new s(function(n,t,e){for(var r=[];a._(n,o,i););return t(n,r);function o(t,e){return n=t,r.push(e),!0}function i(){return!1}})},s.prototype.times=function(u,p){arguments.length<2&&(p=u);var d=this;return new s(function(n,t,e){for(var r,o=[],i=!0,a=0;a<u;a+=1)if(!(i=!!d._(n,s,l)))return e(n,r);for(;a<p&&i;a+=1)d._(n,s,c);return t(n,o);function s(t,e){return o.push(e),n=t,!0}function l(t,e){return r=e,n=t,!1}function c(t,e){return!1}})},s.prototype.result=function(t){return this.then(s.succeed(t))},s.prototype.atMost=function(t){return this.times(0,t)},s.prototype.atLeast=function(t){var n=this;return n.times(t).then(function(e){return n.many().map(function(t){return e.concat(t)})})},s.prototype.map=function(e){return this.then(function(t){return s.succeed(e(t))})},s.prototype.skip=function(e){return this.then(function(t){return e.result(t)})},s.string=function(o){var i=o.length,a="expected '"+o+"'";return new s(function(t,e,n){var r=t.slice(0,i);return r===o?e(t.slice(i),r):n(t,a)})},s.regex=function(o){pray("regexp parser is anchored","^"===o.toString().charAt(1));var i="expected "+o;return new s(function(t,e,n){var r=o.exec(t);return r?(r=r[0],e(t.slice(r.length),r)):n(t,i)})},s.succeed=function(n){return new s(function(t,e){return e(t,n)})},s.fail=function(r){return new s(function(t,e,n){return n(t,r)})},s.letter=s.regex(/^[a-z]/i),s.letters=s.regex(/^[a-z]*/i),s.digit=s.regex(/^[0-9]/),s.digits=s.regex(/^[0-9]*/),s.whitespace=s.regex(/^\s+/),s.optWhitespace=s.regex(/^\s*/),s.any=new s(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),s.all=new s(function(t,e,n){return e("",t)}),s.eof=new s(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)}),s}(),EveryTick=function(){function t(){this.fn=noop}return t.prototype.listen=function(t){this.fn=t,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(this.fn)},t.prototype.listenOnce=function(n){var r=this;this.listen(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r.clearListener(),n.apply(void 0,t)})},t.prototype.clearListener=function(){this.fn=noop,clearTimeout(this.timeoutId)},t.prototype.trigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.fn.apply(this,t)},t}(),saneKeyboardEvents=function(){var r,o;function f(t){switch(i(t)){case"Right":case"Left":case"Down":case"Up":return 1}}function i(t){var e,n;return void 0===t.key?(n=t.which||t.keyCode,r[n]||String.fromCharCode(n)):1===(n=t.key).length&&"a"<=n&&n<="z"?t.key.toUpperCase():null!=(e=o[t.key])?e:t.key}function x(t){var e=i(t),n=[];return t.ctrlKey&&n.push("Ctrl"),t.metaKey&&n.push("Meta"),t.altKey&&n.push("Alt"),t.shiftKey&&n.push("Shift"),n.length?("Alt"!==e&&"Control"!==e&&"Meta"!==e&&"Shift"!==e&&n.push(e),n.join("-")):e}return r={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},o={ArrowRight:"Right",ArrowLeft:"Left",ArrowDown:"Down",ArrowUp:"Up",Delete:"Del",Escape:"Esc"," ":"Spacebar"},function(e,n){var r,o,i,a;function s(){try{e instanceof HTMLTextAreaElement&&e.select()}catch(t){}}function l(){n.options&&n.options.overrideKeystroke?n.options.overrideKeystroke(x(r),r):n.keystroke(x(r),r)}function t(t){i.trigger(t),t.target===e&&(r=t,o=null,a&&i.listenOnce(function(t){t&&"focusout"===t.type||s()}),l())}function c(t){i.trigger(t),t.target===e&&(r&&o&&l(),f(o=t)?i.listenOnce(d):i.listen(p))}function u(t){i.trigger(t),t.target===e&&r&&!o&&(f(t)?i.listenOnce(d):i.listen(p))}function p(){var t;"selectionStart"in e&&e instanceof HTMLTextAreaElement&&e.selectionStart!==e.selectionEnd||e instanceof HTMLTextAreaElement&&(t=e.value,r&&!r.altKey&&r.ctrlKey&&!r.metaKey&&r.shiftKey&&("U"===r.key||"Unidentified"===r.key||"Process"===r.key)||(1===t.length?(e.value="",n.options&&n.options.overrideTypedText?n.options.overrideTypedText(t):n.typedText(t)):d()))}function d(){e instanceof HTMLTextAreaElement&&1<e.value.length&&s()}function h(){o=r=null,i.clearListener(),e instanceof HTMLTextAreaElement&&(e.value="")}function m(t){i.trigger(t)}return o=r=null,i=new EveryTick,a=!1,n.options&&n.options.disableCopyPaste?n.addTextareaEventListeners({keydown:t,keypress:c,keyup:u,focusout:h,copy:function(t){t.preventDefault()},cut:function(t){t.preventDefault()},paste:function(t){i.trigger(),t.preventDefault()},input:m}):n.addTextareaEventListeners({keydown:t,keypress:c,keyup:u,focusout:h,cut:function(){i.listenOnce(function(){n.cut()})},copy:function(){i.listenOnce(function(){n.copy()})},paste:function(t){i.trigger(),t.target===e&&(document.activeElement!==e&&e.focus(),i.listen(function(){var t;e instanceof HTMLTextAreaElement&&(t=e.value,e.value="",t)&&n.paste(t)}))},input:m}),{select:function(t){i.trigger(),i.clearListener(),e instanceof HTMLTextAreaElement&&(e.value=t),t&&s(),a=!!t}}}}(),Controller_exportText=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})},e}(ControllerBase),ControllerBase.onNotify(function(t,e){"edit"!==e&&"replace"!==e&&void 0!==e||(e=t.controller)&&e.options.enableDigitGrouping&&!1===e.blurred&&e.disableGroupingForSeconds(1)}),Controller_focusBlur=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handleTextareaFocusEditable=function(){var t=e.cursor;e.updateMathspeak(),e.blurred=!1,clearTimeout(e.blurTimeout),domFrag(e.container).addClass("mq-focused"),t.parent||t.insAtRightEnd(e.root),t.selection?(t.selection.domFrag().removeClass("mq-blur"),e.selectionChanged()):t.show(),e.setOverflowClasses()},e.handleTextareaBlurEditable=function(){e.textareaSelectionTimeout&&(clearTimeout(e.textareaSelectionTimeout),e.textareaSelectionTimeout=0),e.disableGroupingForSeconds(0),e.blurred=!0,e.blurTimeout=setTimeout(function(){e.root.postOrder(function(t){t.intentionalBlur()}),e.cursor.clearSelection().endSelection(),e.blur(),e.updateMathspeak(),e.scrollHoriz()}),window.addEventListener("blur",e.handleWindowBlur)},e.handleTextareaFocusStatic=function(){e.blurred=!1},e.handleTextareaBlurStatic=function(){e.cursor.selection&&e.cursor.selection.clear(),setTimeout(function(){domFrag(e.getTextareaSpanOrThrow()).detach(),e.blurred=!0})},e.handleWindowBlur=function(){clearTimeout(e.blurTimeout),e.cursor.selection&&e.cursor.selection.domFrag().addClass("mq-blur"),e.blur(),e.updateMathspeak()},e}return __extends(e,t),e.prototype.disableGroupingForSeconds=function(t){var e=this;clearTimeout(this.__disableGroupingTimeout),0===t?this.root.domFrag().removeClass("mq-suppress-grouping"):(this.root.domFrag().addClass("mq-suppress-grouping"),this.__disableGroupingTimeout=setTimeout(function(){e.root.domFrag().removeClass("mq-suppress-grouping")},1e3*t))},e.prototype.blur=function(){this.cursor.hide().parent.blur(this.cursor),domFrag(this.container).removeClass("mq-focused"),window.removeEventListener("blur",this.handleWindowBlur),this.options&&this.options.resetCursorOnBlur&&this.cursor.resetToEnd(this)},e.prototype.addEditableFocusBlurListeners=function(){var t=this.cursor;this.addTextareaEventListeners({focus:this.handleTextareaFocusEditable,blur:this.handleTextareaBlurEditable}),this.blurred=!0,t.hide().parent.blur(t)},e.prototype.addStaticFocusBlurListeners=function(){this.addTextareaEventListeners({focus:this.handleTextareaFocusStatic,blur:this.handleTextareaBlurStatic})},e}(Controller_exportText),INCREMENTAL_SELECTION_OPEN=!1,MQNode=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.keystroke=function(t,e,n){var r=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(L);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(R,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(L,t,e);case"End":n.notify("move").cursor.insAtRightEnd(r.parent),n.aria.queue("end of").queue(r.parent,!0);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root),n.aria.queue("end of").queue(n.ariaLabel).queue(n.root).queue(n.ariaPostLabel);break;case"Shift-End":n.selectToBlockEndInDir(R);break;case"Ctrl-Shift-End":n.selectToRootEndInDir(R);break;case"Home":n.notify("move").cursor.insAtLeftEnd(r.parent),n.aria.queue("beginning of").queue(r.parent,!0);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root),n.aria.queue("beginning of").queue(n.ariaLabel).queue(n.root).queue(n.ariaPostLabel);break;case"Shift-Home":n.selectToBlockEndInDir(L);break;case"Ctrl-Shift-Home":n.selectToRootEndInDir(L);break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":n.withIncrementalSelection(function(t){if(r[L])for(;r[L];)t(L);else t(L)});break;case"Shift-Down":n.withIncrementalSelection(function(t){if(r[R])for(;r[R];)t(R);else t(R)});break;case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(R);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":n.selectAll();break;case"Ctrl-Alt-Up":r.parent.parent&&r.parent.parent instanceof o?n.aria.queue(r.parent.parent):n.aria.queue("nothing above");break;case"Ctrl-Alt-Down":r.parent&&r.parent instanceof o?n.aria.queue(r.parent):n.aria.queue("block is empty");break;case"Ctrl-Alt-Left":r.parent.parent&&r.parent.parent.getEnd(L)?n.aria.queue(r.parent.parent.getEnd(L)):n.aria.queue("nothing to the left");break;case"Ctrl-Alt-Right":r.parent.parent&&r.parent.parent.getEnd(R)?n.aria.queue(r.parent.parent.getEnd(R)):n.aria.queue("nothing to the right");break;case"Ctrl-Alt-Shift-Down":r.selection?n.aria.queue(r.selection.join("mathspeak"," ").trim()+" selected"):n.aria.queue("nothing selected");break;case"Ctrl-Alt-=":case"Ctrl-Alt-Shift-Right":n.ariaPostLabel.length?n.aria.queue(n.ariaPostLabel):n.aria.queue("no answer");break;default:return}n.aria.alert(),null!=e&&e.preventDefault(),n.scrollHoriz()},o.prototype.moveOutOf=function(t,e,n){pray("overridden or never called on this node",!1)},o.prototype.moveTowards=function(t,e,n){pray("overridden or never called on this node",!1)},o.prototype.deleteOutOf=function(t,e){pray("overridden or never called on this node",!1)},o.prototype.deleteTowards=function(t,e){pray("overridden or never called on this node",!1)},o.prototype.unselectInto=function(t,e){pray("overridden or never called on this node",!1)},o.prototype.selectOutOf=function(t,e){pray("overridden or never called on this node",!1)},o.prototype.selectTowards=function(t,e){pray("overridden or never called on this node",!1)},o}(NodeBase),ControllerBase.onNotify(function(t,e){"move"!==e&&"upDown"!==e||t.show().clearSelection()}),baseOptionProcessors.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},ControllerBase.onNotify(function(t,e){"upDown"!==e&&(t.upDownCache={})}),ControllerBase.onNotify(function(t,e){"edit"===e&&t.show().deleteSelection()}),ControllerBase.onNotify(function(t,e){"select"!==e&&t.endSelection()}),Controller_keystroke=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this.getControllerSelf())},e.prototype.escapeDir=function(t,e,n){prayDirection(t);var r=this.cursor;if(r.parent!==this.root&&null!=n&&n.preventDefault(),r.parent!==this.root)return r.clearSelection(),r.parent.moveOutOf(t,r),r.controller.aria.alert(),this.notify("move")},e.prototype.moveDir=function(t){var e,n,r;return prayDirection(t),n=(e=this.cursor).options.leftRightIntoCmdGoes,r=e[t],e.selection?e.insDirOf(t,e.selection.getEnd(t)):r?r.moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},e.prototype.moveLeft=function(){return this.moveDir(L)},e.prototype.moveRight=function(){return this.moveDir(R)},e.prototype.moveUp=function(){return this.moveUpDown("up")},e.prototype.moveDown=function(){return this.moveUpDown("down")},e.prototype.moveUpDown=function(t){var e,n=this.notify("upDown").cursor,r="up"===t?(e="upInto","upOutOf"):(e="downInto","downOutOf"),t=n[L],o=n[R],o=o&&o[e],t=t&&t[e];return o?n.insAtLeftEnd(o):t?n.insAtRightEnd(t):n.parent.bubble(function(t){var e=t[r];if(e&&((e="function"==typeof e?e.call(t,n):e)instanceof MQNode&&n.jumpUpDown(t,e),!0!==e))return!1}),this},e.prototype.deleteDir=function(t){var e,n,r,o;return prayDirection(t),o=(e=this.cursor)[t],r=e.parent.parent,n=e.controller,o&&o instanceof MQNode?o.sides?n.aria.queue(o.parent.chToCmd(o.sides[-t].ch).mathspeak({createdLeftOf:e})):o.blocks||"\\text"===o.parent.ctrlSeq||n.aria.queue(o):r&&r instanceof MQNode&&(r.sides?n.aria.queue(r.parent.chToCmd(r.sides[t].ch).mathspeak({createdLeftOf:e})):r.blocks&&r.mathspeakTemplate?r.upInto&&r.downInto?n.aria.queue(r.mathspeakTemplate[1]):(o=r.mathspeakTemplate,o=t===L?o[0]:o[o.length-1],n.aria.queue(o)):n.aria.queue(r)),o=e.selection,this.notify("edit"),o||((n=e[t])?n.deleteTowards(t,e):e.parent.deleteOutOf(t,e)),r=e[L],o=e[R],r.siblingDeleted&&r.siblingDeleted(e.options,R),o.siblingDeleted&&o.siblingDeleted(e.options,L),e.parent.bubble(function(t){t.reflow()}),this},e.prototype.ctrlDeleteDir=function(t){var e,n;return prayDirection(t),!(e=this.cursor)[t]||e.selection?this.deleteDir(t):(this.notify("edit"),n=t===L?new Fragment(e.parent.getEnd(L),e[L]):new Fragment(e[R],e.parent.getEnd(R)),e.controller.aria.queue(n),n.remove(),e.insAtDirEnd(t,e.parent),n=e[L],t=e[R],n&&n.siblingDeleted(e.options,R),t&&t.siblingDeleted(e.options,L),e.parent.bubble(function(t){t.reflow()}),this)},e.prototype.backspace=function(){return this.deleteDir(L)},e.prototype.deleteForward=function(){return this.deleteDir(R)},e.prototype.startIncrementalSelection=function(){pray("Multiple selections can't be simultaneously open",!INCREMENTAL_SELECTION_OPEN),INCREMENTAL_SELECTION_OPEN=!0,this.notify("select");var t=this.cursor;t.anticursor||t.startSelection()},e.prototype.selectDirIncremental=function(t){var e,n,r;pray("A selection is open",INCREMENTAL_SELECTION_OPEN),INCREMENTAL_SELECTION_OPEN=!0,n=(e=this.cursor).selection,prayDirection(t),(r=e[t])?n&&n.getEnd(t)===r&&e.anticursor[-t]!==r?r.unselectInto(t,e):r.selectTowards(t,e):e.parent.selectOutOf(t,e)},e.prototype.finishIncrementalSelection=function(){var t,e;pray("A selection is open",INCREMENTAL_SELECTION_OPEN),(t=this.cursor).clearSelection(),t.select()||t.show(),(e=t.selection)&&t.controller.aria.clear().queue(e.join("mathspeak"," ").trim()+" selected"),INCREMENTAL_SELECTION_OPEN=!1},e.prototype.withIncrementalSelection=function(t){var e=this;try{this.startIncrementalSelection();try{t(function(t){return e.selectDirIncremental(t)})}finally{this.finishIncrementalSelection()}}finally{INCREMENTAL_SELECTION_OPEN=!1}},e.prototype.selectDir=function(e){this.withIncrementalSelection(function(t){return t(e)})},e.prototype.selectLeft=function(){return this.selectDir(L)},e.prototype.selectRight=function(){return this.selectDir(R)},e.prototype.selectAll=function(){this.notify("move");var e=this.cursor;e.insAtRightEnd(this.root),this.withIncrementalSelection(function(t){for(;e[L];)t(L)})},e.prototype.selectToBlockEndInDir=function(e){var n=this.cursor;this.withIncrementalSelection(function(t){for(;n[e];)t(e)})},e.prototype.selectToRootEndInDir=function(e){var n=this,r=this.cursor;this.withIncrementalSelection(function(t){for(;r[e]||r.parent!==n.root;)t(e)})},e}(Controller_focusBlur),TempSingleCharNode=function(e){function t(t){return e.call(this)||this}return __extends(t,e),t}(MQNode),latexMathParser=function(){var t,e,n,r,o,i,a,s,l,c;function u(t){for(var e=t[0]||new MathBlock,n=1;n<t.length;n+=1)t[n].children().adopt(e,e.getEnd(R),0);return e}return t=Parser.string,o=Parser.regex,a=Parser.letter,l=Parser.digit,i=Parser.any,e=Parser.optWhitespace,n=Parser.succeed,r=Parser.fail,a=a.map(function(t){return new Letter(t)}),l=l.map(function(t){return new Digit(t)}),c=o(/^[^${}\\_^]/).map(function(t){return new VanillaSymbol(t)}),o=o(/^[^\\a-eg-zA-Z]/).or(t("\\").then(o(/^[a-z]+/i).or(o(/^\s+/).result(" ")).or(i))).then(function(t){var e=LatexCmds[t];return e?(e.constructor?new e(t):e(t)).parser():r("unknown command: \\"+t)}).or(a).or(l).or(c),i=t("{").then(function(){return s}).skip(t("}")),a=e.then(i.or(o.map(function(t){var e=new MathBlock;return t.adopt(e,0,0),e}))),s=a.many().map(u).skip(e),l=t("[").then(a.then(function(t){return"]"!==t.join("latex")?n(t):r("")}).many().map(u).skip(e)).skip(t("]")),(c=s).block=a,c.optBlock=l,c}(),baseOptionProcessors.maxDepth=function(t){return"number"==typeof t?t:void 0},Controller_latex=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.cleanLatex=function(t){return t.replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},e.prototype.exportLatex=function(){return this.cleanLatex(this.root.latex())},e.prototype.writeLatex=function(t){var e=this.notify("edit").cursor;return e.parent.writeLatex(e,t),this},e.prototype.exportLatexSelection=function(){var t,e,n,r,o,i,a={latex:"",startIndex:-1,endIndex:-1},s=this.cursor.selection;for(s?(a.startSelectionBefore=s.getEnd(L),a.endSelectionAfter=s.getEnd(R)):((s=this.cursor[L])?a.startSelectionAfter=s:a.startSelectionBefore=this.cursor.parent,(s=this.cursor[R])?a.endSelectionBefore=s:a.endSelectionAfter=this.cursor.parent),this.root.latexRecursive(a),e=this.cleanLatex(t=a.latex),n=a.startIndex,r=a.endIndex,i=o=0;i<a.endIndex;i++)t[i]!==e[o]?(i<a.startIndex&&--n,--r):o+=1;return{latex:e,startIndex:n,endIndex:r}},e.prototype.classifyLatexForEfficientUpdate=function(t){var e;return"string"==typeof t&&(e=t.match(/-?[0-9.]+$/g))&&1===e.length?{latex:t,prefix:t.substr(0,t.length-e[0].length),digits:e[0]}:void 0},e.prototype.updateLatexMathEfficiently=function(t,e){var n,r,o,i,a,s,l,c,u,p,d,h,m,f=this.root,x=this.classifyLatexForEfficientUpdate(t);if(!x)return!1;if(!(e=this.classifyLatexForEfficientUpdate(e))||e.prefix!==x.prefix)return!1;for(n=e.digits,r=x.digits,x=e=!1,"-"===n[0]&&(e=!0,n=n.substr(1)),"-"===r[0]&&(x=!0,r=r.substr(1)),o=this.root.getEnd(R),i=[],a=n.length-1;0<=a;a--){if(!o||o.ctrlSeq!==n[a])return!1;if(o.parent!==f)return!1;i.unshift(o),o=o[L]}if(e&&!x){if(!(m=o))return!1;if("-"!==m.ctrlSeq)return!1;if(m[R]!==i[0])return!1;if(m.parent!==f)return!1;if((h=m[L])&&h.parent!==f)return!1;i[0][L]=m[L],f.getEnd(L)===m&&f.setEnds(((s={})[L]=i[0],s[R]=f.getEnd(R),s)),h&&(h[R]=i[0]),m.domFrag().remove()}for(!e&&x&&(s=new PlusMinus("-"),(h=document.createElement("span")).textContent="-",s.setDOM(h),(m=i[0][L])&&(m[R]=s),f.getEnd(L)===i[0]&&f.setEnds(((e={})[L]=s,e[R]=f.getEnd(R),e)),s.parent=f,s[L]=i[0][L],s[R]=i[0],(i[0][L]=s).contactWeld(this.cursor),s.domFrag().insertBefore(i[0].domFrag())),l=Math.min(n.length,r.length),a=0;a<l;a++)c=r[a],(o=i[a]).ctrlSeq!==c&&(o.ctrlSeq=c,o.domFrag().oneElement().textContent=c,o.mathspeakName=c);if(n.length>r.length)for(o=i[r.length-1],f.setEnds(((x={})[L]=f.getEnd(L),x[R]=o,x)),o[R]=0,a=n.length-1;l<=a;a--)i[a].domFrag().remove();if(r.length>n.length){for(u=document.createDocumentFragment(),a=l;a<r.length;a++)(p=document.createElement("span")).className="mq-digit",p.textContent=r[a],(d=new Digit(r[a])).parent=f,d.setDOM(p),u.appendChild(p),d[L]=f.getEnd(R),d[R]=0,d[L][R]=d,f.setEnds(((p={})[L]=f.getEnd(L),p[R]=d,p));f.domFrag().oneElement().appendChild(u)}return(h=this.exportLatex())!==t?(console.warn("tried updating latex efficiently but did not work. Attempted: "+t+" but wrote: "+h),!1):((m=f.getEnd(R))&&m.fixDigitGrouping(this.cursor.options),!0)},e.prototype.renderLatexMathFromScratch=function(t){var e=this.root,n=this.cursor,r=Parser.all,o=Parser.eof,o=latexMathParser.skip(o).or(r.result(!1)).parse(t);e.setEnds(((r={})[L]=0,r[R]=0,r)),o&&o.children().adopt(e,0,0),o?((t=e.domFrag()).children().remove(),t.oneElement().appendChild(o.html()),e.finalizeInsert(n.options,n)):e.domFrag().empty()},e.prototype.renderLatexMath=function(t){var e,n=this.cursor,r=this.root;this.notify("replace"),n.clearSelection(),e=this.exportLatex(),r.getEnd(L)&&r.getEnd(R)&&e===t||(this.updateLatexMathEfficiently(t,e)||this.renderLatexMathFromScratch(t),this.updateMathspeak()),n.insAtRightEnd(r)},e.prototype.renderLatexText=function(t){var e,n,r,o,i,a,s,l=this.root,c=this.cursor;if(l.domFrag().children().slice(1).remove(),l.setEnds(((e={})[L]=0,e[R]=0,e)),delete c.selection,c.show().insAtRightEnd(l),e=Parser.regex,i=Parser.string,n=Parser.eof,r=Parser.all,o=i("$").then(latexMathParser).skip(i("$").or(n)).map(function(t){var e,n=new RootMathCommand(c);return n.createBlocks(),e=n.getEnd(L),t.children().adopt(e,0,0),n}),i=i("\\$").result("$").or(e(/^[^$]/)).map(function(t){return new VanillaSymbol(t)}),a=o.or(i).many().skip(n).or(r.result(!1)).parse(t)){for(s=0;s<a.length;s+=1)a[s].adopt(l,l.getEnd(R),0);domFrag(l.html()).appendTo(l.domFrag().oneElement()),l.finalizeInsert(c.options,c)}},e}(Controller_keystroke),Options.prototype.ignoreNextMousedown=ignoreNextMouseDownNoop=function(t){return!1},ControllerBase.onNotify(function(t,e){"edit"!==e&&"replace"!==e||cancelSelectionOnEdit&&cancelSelectionOnEdit.cursor===t&&cancelSelectionOnEdit.cb()}),Controller_mouse=function(t){function e(){var f=null!==t&&t.apply(this,arguments)||this;return f.handleMouseDown=function(t){var e,n,r,o,i,a,s,l,c;function u(t){l=t.target}function p(t){o.anticursor||o.startSelection(),r.seek(l,t.clientX,t.clientY).cursor.select(),o.selection&&o.controller.aria.clear().queue(o.selection.join("mathspeak")+" selected").alert(),l=null}function d(){null!=e&&e.removeEventListener("mousemove",u),null!=n&&n.removeEventListener("mousemove",p),null!=n&&n.removeEventListener("mouseup",m),cancelSelectionOnEdit=void 0}function h(){r.editable?(o.show(),o.controller.aria.queue(o.parent).alert()):domFrag(a).detach()}function m(){o.blink=i,o.selection||h(),d()}s=(e=closest(t.target,".mq-root-block"))&&NodeBase.getNodeOfElement(e)||NodeBase.getNodeOfElement(f.root.domFrag().oneElement()),n=s.domFrag().firstNode().ownerDocument,r=s.controller,o=r.cursor,i=o.blink,a=r.getTextareaSpanOrThrow(),s=r.getTextareaOrThrow(),t.preventDefault(),t.target.unselectable=!0,o.options.ignoreNextMousedown(t)||closest(t.target,".mq-ignore-mousedown")||(l=null,cancelSelectionOnEdit={cursor:o,cb:function(){c=!0,o.blink=i,o.clearSelection(),h(),d()}},r.blurred&&(e&&!r.editable&&domFrag(e).prepend(domFrag(a)),s.focus(),c))||(o.blink=noop,r.seek(t.target,t.clientX,t.clientY).cursor.startSelection(),null!=e&&e.addEventListener("mousemove",u),null!=n&&n.addEventListener("mousemove",p),null!=n&&n.addEventListener("mouseup",m))},f}return __extends(e,t),e.prototype.addMouseEventListener=function(){this.container.addEventListener("mousedown",this.handleMouseDown)},e.prototype.removeMouseEventListener=function(){this.container.removeEventListener("mousedown",this.handleMouseDown)},e.prototype.seek=function(t,e,n){for(var r,o=this.notify("select").cursor;t&&!(r=NodeBase.getNodeOfElement(t));)t=t.parentElement;return r=r||this.root,o.clearSelection().show(),r.seek(e,o),this.scrollHoriz(),this},e}(Controller_latex),Controller_scrollHoriz=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setOverflowClasses=function(){var t,e,n=this.root.domFrag().oneElement(),r=!1,o=!1;this.blurred||(e=getBoundingClientRect(n).width,t=n.scrollWidth,r=e+(e=n.scrollLeft)<t,o=0<e),n.classList.contains("mq-editing-overflow-right")!==r&&n.classList.toggle("mq-editing-overflow-right"),n.classList.contains("mq-editing-overflow-left")!==o&&n.classList.toggle("mq-editing-overflow-left")},e.prototype.scrollHoriz=function(){var r,o,i,t,e,n,a,s,l=this,c=this.cursor,u=c.selection,p=getBoundingClientRect(this.root.domFrag().oneElement());if(c.domFrag().isEmpty()&&!u)this.cancelScrollHoriz&&(this.cancelScrollHoriz(),this.cancelScrollHoriz=void 0),r=this.root.domFrag().oneElement(),o=r.scrollLeft,animate(this.getScrollAnimationDuration(),function(t,e,n){1<=t?(l.cancelScrollHoriz=void 0,r.scrollLeft=0,l.setOverflowClasses()):(l.cancelScrollHoriz=n,e(),r.scrollLeft=Math.round((1-t)*o))});else{if(u)if(t=(n=getBoundingClientRect(u.domFrag().oneElement())).left-(p.left+20),e=n.right-(p.right-20),u.getEnd(L)===c[R])if(t<0)i=t;else{if(!(0<e))return;i=n.left-e<p.left+20?t:e}else if(0<e)i=e;else{if(!(t<0))return;i=n.right-t>p.right-20?e:t}else if((u=getBoundingClientRect(c.domFrag().oneElement()).left)>p.right-20)i=u-(p.right-20);else{if(!(u<p.left+20))return;i=u-(p.left+20)}n=this.root.domFrag().oneElement(),i<0&&0===n.scrollLeft||0<i&&n.scrollWidth<=n.scrollLeft+p.width||(this.cancelScrollHoriz&&(this.cancelScrollHoriz(),this.cancelScrollHoriz=void 0),a=this.root.domFrag().oneElement(),s=a.scrollLeft,animate(this.getScrollAnimationDuration(),function(t,e,n){1<=t?(l.cancelScrollHoriz=void 0,a.scrollLeft=Math.round(s+i),l.setOverflowClasses()):(l.cancelScrollHoriz=n,e(),a.scrollLeft=Math.round(s+t*i))}))}},e.prototype.getScrollAnimationDuration=function(){var t;return null!=(t=this.options.scrollAnimationDuration)?t:100},e}(Controller_mouse),Options.prototype.substituteTextarea=function(){return h("textarea",{autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:!1,"x-palm-disable-ste-all":!0})},Options.prototype.substituteKeyboardEvents=defaultSubstituteKeyboardEvents,Controller=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectFn=noop,t}return __extends(t,e),t.prototype.createTextarea=function(){var t,e;if(this.textareaSpan=h("span",{class:"mq-textarea"}),!(t=this.options.substituteTextarea()).nodeType)throw"substituteTextarea() must return a DOM element, got "+t;this.textarea=domFrag(t).appendTo(this.textareaSpan).oneElement(),(e=this).cursor.selectionChanged=function(){e.selectionChanged()}},t.prototype.selectionChanged=function(){var t=this;t.textareaSelectionTimeout||(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.prototype.setTextareaSelection=function(){this.textareaSelectionTimeout=0;var t="";this.cursor.selection&&(t=this.cleanLatex(this.cursor.selection.join("latex")),this.options.statelessClipboard)&&(t="$"+t+"$"),this.selectFn(t)},t.prototype.staticMathTextareaEvents=function(){var n=this;this.removeTextareaEventListener("cut"),this.removeTextareaEventListener("paste"),n.options.disableCopyPaste?this.removeTextareaEventListener("copy"):this.addTextareaEventListeners({copy:function(){n.setTextareaSelection()}}),this.addStaticFocusBlurListeners(),n.selectFn=function(t){var e=n.getTextareaOrThrow();e instanceof HTMLTextAreaElement&&(e.value=t)&&e.select()}},t.prototype.editablesTextareaEvents=function(){var e,t,n=this.getTextareaOrThrow(),r=this.getTextareaSpanOrThrow();this.options.version<3?(t=this.options.assertJquery(),e=this.options.substituteKeyboardEvents(t(n),this),this.selectFn=function(t){e.select(t)}):(t=saneKeyboardEvents(n,this).select,this.selectFn=t),domFrag(this.container).prepend(domFrag(r)),this.addEditableFocusBlurListeners(),this.updateMathspeak()},t.prototype.unbindEditablesEvents=function(){var e=this.getTextareaOrThrow(),t=this.getTextareaSpanOrThrow();this.selectFn=function(t){e instanceof HTMLTextAreaElement&&(e.value=t)&&e.select()},domFrag(t).remove(),this.removeTextareaEventListener("focus"),this.removeTextareaEventListener("blur"),this.blurred=!0,this.removeTextareaEventListener("cut"),this.removeTextareaEventListener("paste")},t.prototype.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify(void 0).cursor;e.parent.write(e,t),this.scrollHoriz()},t.prototype.cut=function(){var t=this,e=t.cursor;e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble(function(t){t.reflow()}),t.options&&t.options.onCut&&t.options.onCut()})},t.prototype.copy=function(){this.setTextareaSelection()},t.prototype.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show(),this.scrollHoriz(),this.options&&this.options.onPaste&&this.options.onPaste()},t.prototype.setupStaticField=function(){this.mathspeakSpan=h("span",{class:"mq-mathspeak"}),domFrag(this.container).prepend(domFrag(this.mathspeakSpan)),this.updateMathspeak(),this.blurred=!0,this.cursor.hide().parent.blur(this.cursor)},t.prototype.updateMathspeak=function(){var t,e=this,n=e.getAriaLabel(),n=/[A-Za-z0-9]$/.test(n)?n+":":n,r=e.root.mathspeak().trim();this.aria.clear(),t=e.getTextareaOrThrow(),e.mathspeakSpan?(t.setAttribute("aria-label",""),e.mathspeakSpan.textContent=(n+" "+r).trim()):t.setAttribute("aria-label",(n+" "+r+" "+e.ariaPostLabel).trim())},t}(Controller_scrollHoriz),MathElement=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.finalizeInsert=function(e,n){var t,r,o=this;o.postOrder(function(t){t.finalizeTree(e)}),o.postOrder(function(t){t.contactWeld(n)}),o.postOrder(function(t){t.blur(n)}),o.postOrder(function(t){t.reflow()}),t=o[R],r=o[L],t&&t.siblingCreated(e,L),r&&r.siblingCreated(e,R),o.bubble(function(t){t.reflow()})},e.prototype.prepareInsertionAt=function(t){var e=t.options.maxDepth;if(void 0!==e){if(e<(t=t.depth()))return!1;this.removeNodesDeeperThan(e-t)}return!0},e.prototype.removeNodesDeeperThan=function(n){for(var t,r,o=0,i=[[this,o]];t=i.shift();)(r=t)[0].children().each(function(t){var e=t instanceof MathBlock?1:0;(o=r[1]+e)<=n?i.push([t,o]):(e?t.children():t).remove()})},e}(MQNode),DOMView=function(t,e){this.childCount=t,this.render=e},MathCommand=function(o){function t(t,e,n){var r=o.call(this)||this;return r.textTemplate=[""],r.mathspeakTemplate=[""],r.setCtrlSeqHtmlAndText(t,e,n),r}return __extends(t,o),t.prototype.setEnds=function(t){pray("MathCommand ends are never empty",t[L]&&t[R]),this.ends=t},t.prototype.getEnd=function(t){return this.ends[t]},t.prototype.setCtrlSeqHtmlAndText=function(t,e,n){this.ctrlSeq||(this.ctrlSeq=t),e&&(this.domView=e),n&&(this.textTemplate=n)},t.prototype.replaces=function(t){t.disown(),this.replacedFragment=t},t.prototype.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.prototype.parser=function(){var n=this;return latexMathParser.block.times(this.numBlocks()).map(function(t){n.blocks=t;for(var e=0;e<t.length;e+=1)t[e].adopt(n,n.getEnd(R),0);return n})},t.prototype.createLeftOf=function(t){var e,n=this,r=n.replacedFragment;n.createBlocks(),o.prototype.createLeftOf.call(this,t),r&&(e=n.getEnd(L),r.adopt(e,0,0),r.domFrag().appendTo(e.domFrag().oneElement()),n.placeCursor(t),n.prepareInsertionAt(t)),n.finalizeInsert(t.options,t),n.placeCursor(t)},t.prototype.createBlocks=function(){for(var t=this.numBlocks(),e=this.blocks=Array(t),n=0;n<t;n+=1)(e[n]=new MathBlock).adopt(this,this.getEnd(R),0)},t.prototype.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.getEnd(L),function(t,e){return t.isEmpty()?t:e}))},t.prototype.moveTowards=function(t,e,n){var r;"up"===n?r=this.upInto:"down"===n&&(r=this.downInto),n=r||this.getEnd(-t),e.insAtDirEnd(-t,n),e.controller.aria.queueDirEndOf(-t).queue(e.parent,!0)},t.prototype.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e)},t.prototype.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.prototype.selectChildren=function(){return new MQSelection(this,this)},t.prototype.unselectInto=function(t,e){var n=e.anticursor.ancestors[this.id];e.insAtDirEnd(-t,n)},t.prototype.seek=function(n,r){var o,i,a;function s(t){var t=t.domFrag().oneElement(),e=getBoundingClientRect(t).left,t=e+t.offsetWidth,n={};return n[L]=e,n[R]=t,n}return i=s(o=this),n<i[L]?r.insLeftOf(o):n>i[R]?r.insRightOf(o):(a=i[L],void o.eachChild(function(t){var e=s(t);return n<e[L]?(n-a<e[L]-n?t[L]?r.insAtRightEnd(t[L]):r.insLeftOf(o):r.insAtLeftEnd(t),!1):n>e[R]?void(t[R]?a=e[R]:i[R]-n<n-e[R]?r.insRightOf(o):r.insAtRightEnd(t)):(t.seek(n,r),!1)}))},t.prototype.numBlocks=function(){return this.domView.childCount},t.prototype.html=function(){var t=this.blocks;return pray("domView is defined",this.domView),t=this.domView.render(t||[]),this.setDOM(t),NodeBase.linkElementByCmdNode(t,this),t},t.prototype.latexRecursive=function(n){this.checkCursorContextOpen(n),n.latex+=this.ctrlSeq||"",this.eachChild(function(t){var e;n.latex+="{",e=n.latex.length,t.latexRecursive(n),e===n.latex.length&&(n.latex+=" "),n.latex+="}"}),this.checkCursorContextClose(n)},t.prototype.text=function(){var n=this,r=0;return n.foldChildren(n.textTemplate[r],function(t,e){r+=1;e=e.text();return t&&"("===n.textTemplate[r]&&"("===e[0]&&")"===e.slice(-1)?t+e.slice(1,-1)+n.textTemplate[r]:t+e+(n.textTemplate[r]||"")})},t.prototype.mathspeak=function(){var n=this,r=0;return n.foldChildren(n.mathspeakTemplate[r]||"Start"+n.ctrlSeq+" ",function(t,e){return r+=1,t+" "+e.mathspeak()+" "+(n.mathspeakTemplate[r]+" "||"End"+n.ctrlSeq+" ")})},t}(MathElement),MQSymbol=function(i){function t(t,e,n,r){var o=i.call(this)||this;return o.setCtrlSeqHtmlTextAndMathspeak(t,e?new DOMView(0,function(){return e.cloneNode(!0)}):void 0,n,r),o}return __extends(t,i),t.prototype.setCtrlSeqHtmlTextAndMathspeak=function(t,e,n,r){!n&&t&&(n=t.replace(/^\\/,"")),this.mathspeakName=r||n,i.prototype.setCtrlSeqHtmlAndText.call(this,t,e,[n||""])},t.prototype.parser=function(){return Parser.succeed(this)},t.prototype.numBlocks=function(){return 0},t.prototype.replaces=function(t){t.remove()},t.prototype.createBlocks=function(){},t.prototype.moveTowards=function(t,e){e.domFrag().insDirOf(t,this.domFrag()),e[-t]=this,e[t]=this[t],e.controller.aria.queue(this)},t.prototype.deleteTowards=function(t,e){e[t]=this.remove()[t]},t.prototype.seek=function(t,e){var n=this.domFrag().oneElement();return t-getBoundingClientRect(n).left<n.offsetWidth/2?e.insLeftOf(this):e.insRightOf(this),e},t.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t),t.latex+=this.ctrlSeq||"",this.checkCursorContextClose(t)},t.prototype.text=function(){return this.textTemplate.join("")},t.prototype.mathspeak=function(t){return this.mathspeakName||""},t.prototype.placeCursor=function(){},t.prototype.isEmpty=function(){return!0},t}(MathCommand),VanillaSymbol=function(r){function t(t,e,n){return r.call(this,t,h("span",{},[e||h.text(t)]),void 0,n)||this}return __extends(t,r),t}(MQSymbol),BinaryOperator=function(i){function t(t,e,n,r,o){return o?i.call(this,t,h("span",{},[e||h.text(t||"")]),void 0,r)||this:i.call(this,t,h("span",{class:"mq-binary-operator"},e?[e]:[]),n,r)||this}return __extends(t,i),t}(MQSymbol),MathBlock=function(r){function t(){var t=null!==r&&r.apply(this,arguments)||this;return t.ariaLabel="block",t}return __extends(t,r),t.prototype.join=function(n){return this.foldChildren("",function(t,e){return t+e[n]()})},t.prototype.html=function(){var e=document.createDocumentFragment();return this.eachChild(function(t){t=t.html();e.appendChild(t)}),e},t.prototype.latexRecursive=function(e){this.checkCursorContextOpen(e),this.eachChild(function(t){return t.latexRecursive(e)}),this.checkCursorContextClose(e)},t.prototype.text=function(){var t=this.getEnd(L);return t===this.getEnd(R)&&0!==t?t.text():this.join("text")},t.prototype.mathspeak=function(){var o="",i={};return this.controller&&(i=this.controller.options.autoOperatorNames),this.foldChildren([],function(t,e){var n,r;return e.isPartOfOperator?o+=e.mathspeak():(""!==o&&(0<i._maxLength&&"string"==typeof(n=i[o.toLowerCase()])&&(o=n),t.push(o+" "),o=""),n=e.mathspeak(),r=e.ctrlSeq,!isNaN(r)||"."===r||e.parent&&e.parent.parent&&e.parent.parent.isTextBlock()||(n=" "+n+" "),t.push(n)),t}).join("").replace(/ +(?= )/g,"").replace(/(\.)([0-9]+)/g,function(t,e,n){return e+n.split("").join(" ").trim()})},t.prototype.keystroke=function(t,e,n){if(!n.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t)return r.prototype.keystroke.call(this,t,e,n);null!=e&&e.preventDefault(),n.escapeDir("Shift-Spacebar"===t?L:R,t,e)},t.prototype.moveOutOf=function(t,e,n){var r;"up"===n?r=this.parent.upInto:"down"===n&&(r=this.parent.downInto),!r&&this[t]?(e.insAtDirEnd(n=-t,this[t]),e.controller.aria.queueDirEndOf(n).queue(e.parent,!0)):(e.insDirOf(t,this.parent),e.controller.aria.queueDirOf(t).queue(this.parent))},t.prototype.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.prototype.deleteOutOf=function(t,e){e.unwrapGramp()},t.prototype.seek=function(t,e){var n,r=this.getEnd(R);if(!r)return e.insAtRightEnd(this);if(getBoundingClientRect(n=r.domFrag().oneElement()).left+n.offsetWidth<t)return e.insAtRightEnd(this);if(t<getBoundingClientRect(this.getEnd(L).domFrag().oneElement()).left)return e.insAtLeftEnd(this);for(;t<getBoundingClientRect(r.domFrag().oneElement()).left;)r=r[L];return r.seek(t,e)},t.prototype.chToCmd=function(t,e){return t.match(/^[a-eg-zA-Z]$/)?new Letter(t):/^\d$/.test(t)?new Digit(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?LatexCmds["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?LatexCmds["×"](t):e&&e.typingPercentWritesPercentOf&&"%"===t?LatexCmds.percentof(t):(e=CharCmds[t]||LatexCmds[t])?e.constructor?new e(t):e(t):new VanillaSymbol(t)},t.prototype.write=function(t,e){var n=this.chToCmd(e,t.options);t.selection&&n.replaces(t.replaceSelection()),t.isTooDeep()||(n.createLeftOf(t.show()),"/"===e?t.controller.aria.alert("over"):t.controller.aria.alert(n.mathspeak({createdLeftOf:t})))},t.prototype.writeLatex=function(t,e){var n=Parser.all,r=Parser.eof,r=latexMathParser.skip(r).or(n.result(!1)).parse(e);r&&!r.isEmpty()&&r.prepareInsertionAt(t)&&(r.children().adopt(t.parent,t[L],t[R]),domFrag(r.html()).insertBefore(t.domFrag()),t[L]=r.getEnd(R),r.finalizeInsert(t.options,t),n=r.getEnd(R),e=r.getEnd(L),r=n[R],n=e[L],r&&r.siblingCreated(t.options,L),n&&n.siblingCreated(t.options,R),t.parent.bubble(function(t){t.reflow()}))},t.prototype.focus=function(){return this.domFrag().addClass("mq-hasCursor"),this.domFrag().removeClass("mq-empty"),this},t.prototype.blur=function(t){return this.domFrag().removeClass("mq-hasCursor"),this.isEmpty()&&(this.domFrag().addClass("mq-empty"),t)&&this.isQuietEmptyDelimiter(t.options.quietEmptyDelimiters)&&this.domFrag().addClass("mq-quiet-delimiter"),this},t}(MathElement),Options.prototype.mouseEvents=!0,API.StaticMath=function(r){var t,o;return o=r.AbstractMathQuill,__extends(e,o),e.prototype.__mathquillify=function(t,e){return this.config(t),o.prototype.mathquillify.call(this,"mq-math-mode"),this.__controller.setupStaticField(),this.__options.mouseEvents&&(this.__controller.addMouseEventListener(),this.__controller.staticMathTextareaEvents()),this},e.prototype.latex=function(t){var e,n=o.prototype.latex.apply(this,arguments);return 0<arguments.length&&(e=this.innerFields=[],this.__controller.root.postOrder(function(t){t.registerInnerField(e,r.InnerMathField)}),this.__controller.updateMathspeak()),n},e.prototype.setAriaLabel=function(t){return this.__controller.setAriaLabel(t),this},e.prototype.getAriaLabel=function(){return this.__controller.getAriaLabel()},(t=e).RootBlock=MathBlock,t;function e(t){var t=o.call(this,t)||this,e=t.innerFields=[];return t.__controller.root.postOrder(function(t){t.registerInnerField(e,r.InnerMathField)}),t}},RootBlockMixin((RootMathBlock=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(MathBlock)).prototype),API.MathField=function(t){var n;return n=t.EditableField,__extends(e,n),e.prototype.__mathquillify=function(t,e){return this.config(t),1<e&&(this.__controller.root.reflow=noop),n.prototype.mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this},(t=e).RootBlock=RootMathBlock,t;function e(){return null!==n&&n.apply(this,arguments)||this}},API.InnerMathField=function(t){return pray("MathField class is defined",t.MathField),n=t.MathField,__extends(e,n),e.prototype.makeStatic=function(){this.__controller.editable=!1,this.__controller.root.blur(),this.__controller.unbindEditablesEvents(),domFrag(this.__controller.container).removeClass("mq-editable-field")},e.prototype.makeEditable=function(){this.__controller.editable=!0,this.__controller.editablesTextareaEvents(),this.__controller.cursor.insAtRightEnd(this.__controller.root),domFrag(this.__controller.container).addClass("mq-editable-field")},e;function e(){return null!==n&&n.apply(this,arguments)||this}var n},LatexCmds.notin=LatexCmds.cong=LatexCmds.equiv=LatexCmds.oplus=LatexCmds.otimes=function(t){return new BinaryOperator("\\"+t+" ",h.entityText("&"+t+";"))},LatexCmds["∗"]=LatexCmds.ast=LatexCmds.star=LatexCmds.loast=LatexCmds.lowast=bindBinaryOperator("\\ast ","&lowast;","low asterisk"),LatexCmds.therefor=LatexCmds.therefore=bindBinaryOperator("\\therefore ","&there4;","therefore"),LatexCmds.cuz=LatexCmds.because=bindBinaryOperator("\\because ","&#8757;","because"),LatexCmds.prop=LatexCmds.propto=bindBinaryOperator("\\propto ","&prop;","proportional to"),LatexCmds["≈"]=LatexCmds.asymp=LatexCmds.approx=bindBinaryOperator("\\approx ","&asymp;","approximately equal to"),LatexCmds.isin=LatexCmds.in=bindBinaryOperator("\\in ","&isin;","is in"),LatexCmds.ni=LatexCmds.contains=bindBinaryOperator("\\ni ","&ni;","is not in"),LatexCmds.notni=LatexCmds.niton=LatexCmds.notcontains=LatexCmds.doesnotcontain=bindBinaryOperator("\\not\\ni ","&#8716;","does not contain"),LatexCmds.sub=LatexCmds.subset=bindBinaryOperator("\\subset ","&sub;","subset"),LatexCmds.sup=LatexCmds.supset=LatexCmds.superset=bindBinaryOperator("\\supset ","&sup;","superset"),LatexCmds.nsub=LatexCmds.notsub=LatexCmds.nsubset=LatexCmds.notsubset=bindBinaryOperator("\\not\\subset ","&#8836;","not a subset"),LatexCmds.nsup=LatexCmds.notsup=LatexCmds.nsupset=LatexCmds.notsupset=LatexCmds.nsuperset=LatexCmds.notsuperset=bindBinaryOperator("\\not\\supset ","&#8837;","not a superset"),LatexCmds.sube=LatexCmds.subeq=LatexCmds.subsete=LatexCmds.subseteq=bindBinaryOperator("\\subseteq ","&sube;","subset or equal to"),LatexCmds.supe=LatexCmds.supeq=LatexCmds.supsete=LatexCmds.supseteq=LatexCmds.supersete=LatexCmds.superseteq=bindBinaryOperator("\\supseteq ","&supe;","superset or equal to"),LatexCmds.nsube=LatexCmds.nsubeq=LatexCmds.notsube=LatexCmds.notsubeq=LatexCmds.nsubsete=LatexCmds.nsubseteq=LatexCmds.notsubsete=LatexCmds.notsubseteq=bindBinaryOperator("\\not\\subseteq ","&#8840;","not subset or equal to"),LatexCmds.nsupe=LatexCmds.nsupeq=LatexCmds.notsupe=LatexCmds.notsupeq=LatexCmds.nsupsete=LatexCmds.nsupseteq=LatexCmds.notsupsete=LatexCmds.notsupseteq=LatexCmds.nsupersete=LatexCmds.nsuperseteq=LatexCmds.notsupersete=LatexCmds.notsuperseteq=bindBinaryOperator("\\not\\supseteq ","&#8841;","not superset or equal to"),LatexCmds.mathbb=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createLeftOf=function(t){},e.prototype.numBlocks=function(){return 1},e.prototype.parser=function(){var t=Parser.string,e=Parser.regex,n=Parser.optWhitespace;return n.then(t("{")).then(n).then(e(/^[NPZQRCH]/)).skip(n).skip(t("}")).map(function(t){t=LatexCmds[t];return isMQNodeClass(t)?new t:t()})},e}(MathCommand),LatexCmds.N=LatexCmds.naturals=LatexCmds.Naturals=bindVanillaSymbol("\\mathbb{N}","&#8469;","naturals"),LatexCmds.P=LatexCmds.primes=LatexCmds.Primes=LatexCmds.projective=LatexCmds.Projective=LatexCmds.probability=LatexCmds.Probability=bindVanillaSymbol("\\mathbb{P}","&#8473;","P"),LatexCmds.Z=LatexCmds.integers=LatexCmds.Integers=bindVanillaSymbol("\\mathbb{Z}","&#8484;","integers"),LatexCmds.Q=LatexCmds.rationals=LatexCmds.Rationals=bindVanillaSymbol("\\mathbb{Q}","&#8474;","rationals"),LatexCmds.R=LatexCmds.reals=LatexCmds.Reals=bindVanillaSymbol("\\mathbb{R}","&#8477;","reals"),LatexCmds.C=LatexCmds.complex=LatexCmds.Complex=LatexCmds.complexes=LatexCmds.Complexes=LatexCmds.complexplane=LatexCmds.Complexplane=LatexCmds.ComplexPlane=bindVanillaSymbol("\\mathbb{C}","&#8450;","complexes"),LatexCmds.H=LatexCmds.Hamiltonian=LatexCmds.quaternions=LatexCmds.Quaternions=bindVanillaSymbol("\\mathbb{H}","&#8461;","quaternions"),LatexCmds.quad=LatexCmds.emsp=bindVanillaSymbol("\\quad ","    ","4 spaces"),LatexCmds.qquad=bindVanillaSymbol("\\qquad ","        ","8 spaces"),LatexCmds.diamond=bindVanillaSymbol("\\diamond ","&#9671;","diamond"),LatexCmds.bigtriangleup=bindVanillaSymbol("\\bigtriangleup ","&#9651;","triangle up"),LatexCmds.ominus=bindVanillaSymbol("\\ominus ","&#8854;","o minus"),LatexCmds.uplus=bindVanillaSymbol("\\uplus ","&#8846;","disjoint union"),LatexCmds.bigtriangledown=bindVanillaSymbol("\\bigtriangledown ","&#9661;","triangle down"),LatexCmds.sqcap=bindVanillaSymbol("\\sqcap ","&#8851;","greatest lower bound"),LatexCmds.triangleleft=bindVanillaSymbol("\\triangleleft ","&#8882;","triangle left"),LatexCmds.sqcup=bindVanillaSymbol("\\sqcup ","&#8852;","least upper bound"),LatexCmds.triangleright=bindVanillaSymbol("\\triangleright ","&#8883;","triangle right"),LatexCmds.odot=LatexCmds.circledot=bindVanillaSymbol("\\odot ","&#8857;","circle dot"),LatexCmds.bigcirc=bindVanillaSymbol("\\bigcirc ","&#9711;","circle"),LatexCmds.dagger=bindVanillaSymbol("\\dagger ","&#0134;","dagger"),LatexCmds.ddagger=bindVanillaSymbol("\\ddagger ","&#135;","big dagger"),LatexCmds.wr=bindVanillaSymbol("\\wr ","&#8768;","wreath"),LatexCmds.amalg=bindVanillaSymbol("\\amalg ","&#8720;","amalgam"),LatexCmds.models=bindVanillaSymbol("\\models ","&#8872;","models"),LatexCmds.prec=bindVanillaSymbol("\\prec ","&#8826;","precedes"),LatexCmds.succ=bindVanillaSymbol("\\succ ","&#8827;","succeeds"),LatexCmds.preceq=bindVanillaSymbol("\\preceq ","&#8828;","precedes or equals"),LatexCmds.succeq=bindVanillaSymbol("\\succeq ","&#8829;","succeeds or equals"),LatexCmds.simeq=bindVanillaSymbol("\\simeq ","&#8771;","similar or equal to"),LatexCmds.mid=bindVanillaSymbol("\\mid ","&#8739;","divides"),LatexCmds.ll=bindVanillaSymbol("\\ll ","&#8810;","ll"),LatexCmds.gg=bindVanillaSymbol("\\gg ","&#8811;","gg"),LatexCmds.parallel=bindVanillaSymbol("\\parallel ","&#8741;","parallel with"),LatexCmds.nparallel=bindVanillaSymbol("\\nparallel ","&#8742;","not parallel with"),LatexCmds.bowtie=bindVanillaSymbol("\\bowtie ","&#8904;","bowtie"),LatexCmds.sqsubset=bindVanillaSymbol("\\sqsubset ","&#8847;","square subset"),LatexCmds.sqsupset=bindVanillaSymbol("\\sqsupset ","&#8848;","square superset"),LatexCmds.smile=bindVanillaSymbol("\\smile ","&#8995;","smile"),LatexCmds.sqsubseteq=bindVanillaSymbol("\\sqsubseteq ","&#8849;","square subset or equal to"),LatexCmds.sqsupseteq=bindVanillaSymbol("\\sqsupseteq ","&#8850;","square superset or equal to"),LatexCmds.doteq=bindVanillaSymbol("\\doteq ","&#8784;","dotted equals"),LatexCmds.frown=bindVanillaSymbol("\\frown ","&#8994;","frown"),LatexCmds.vdash=bindVanillaSymbol("\\vdash ","&#8870;","v dash"),LatexCmds.dashv=bindVanillaSymbol("\\dashv ","&#8867;","dash v"),LatexCmds.nless=bindVanillaSymbol("\\nless ","&#8814;","not less than"),LatexCmds.ngtr=bindVanillaSymbol("\\ngtr ","&#8815;","not greater than"),LatexCmds.longleftarrow=bindVanillaSymbol("\\longleftarrow ","&#8592;","left arrow"),LatexCmds.longrightarrow=bindVanillaSymbol("\\longrightarrow ","&#8594;","right arrow"),LatexCmds.Longleftarrow=bindVanillaSymbol("\\Longleftarrow ","&#8656;","left arrow"),LatexCmds.Longrightarrow=bindVanillaSymbol("\\Longrightarrow ","&#8658;","right arrow"),LatexCmds.longleftrightarrow=bindVanillaSymbol("\\longleftrightarrow ","&#8596;","left and right arrow"),LatexCmds.updownarrow=bindVanillaSymbol("\\updownarrow ","&#8597;","up and down arrow"),LatexCmds.Longleftrightarrow=bindVanillaSymbol("\\Longleftrightarrow ","&#8660;","left and right arrow"),LatexCmds.Updownarrow=bindVanillaSymbol("\\Updownarrow ","&#8661;","up and down arrow"),LatexCmds.mapsto=bindVanillaSymbol("\\mapsto ","&#8614;","maps to"),LatexCmds.nearrow=bindVanillaSymbol("\\nearrow ","&#8599;","northeast arrow"),LatexCmds.hookleftarrow=bindVanillaSymbol("\\hookleftarrow ","&#8617;","hook left arrow"),LatexCmds.hookrightarrow=bindVanillaSymbol("\\hookrightarrow ","&#8618;","hook right arrow"),LatexCmds.searrow=bindVanillaSymbol("\\searrow ","&#8600;","southeast arrow"),LatexCmds.leftharpoonup=bindVanillaSymbol("\\leftharpoonup ","&#8636;","left harpoon up"),LatexCmds.rightharpoonup=bindVanillaSymbol("\\rightharpoonup ","&#8640;","right harpoon up"),LatexCmds.swarrow=bindVanillaSymbol("\\swarrow ","&#8601;","southwest arrow"),LatexCmds.leftharpoondown=bindVanillaSymbol("\\leftharpoondown ","&#8637;","left harpoon down"),LatexCmds.rightharpoondown=bindVanillaSymbol("\\rightharpoondown ","&#8641;","right harpoon down"),LatexCmds.nwarrow=bindVanillaSymbol("\\nwarrow ","&#8598;","northwest arrow"),LatexCmds.ldots=bindVanillaSymbol("\\ldots ","&#8230;","l dots"),LatexCmds.cdots=bindVanillaSymbol("\\cdots ","&#8943;","c dots"),LatexCmds.vdots=bindVanillaSymbol("\\vdots ","&#8942;","v dots"),LatexCmds.ddots=bindVanillaSymbol("\\ddots ","&#8945;","d dots"),LatexCmds.surd=bindVanillaSymbol("\\surd ","&#8730;","unresolved root"),LatexCmds.triangle=bindVanillaSymbol("\\triangle ","&#9651;","triangle"),LatexCmds.ell=bindVanillaSymbol("\\ell ","&#8467;","ell"),LatexCmds.top=bindVanillaSymbol("\\top ","&#8868;","top"),LatexCmds.flat=bindVanillaSymbol("\\flat ","&#9837;","flat"),LatexCmds.natural=bindVanillaSymbol("\\natural ","&#9838;","natural"),LatexCmds.sharp=bindVanillaSymbol("\\sharp ","&#9839;","sharp"),LatexCmds.wp=bindVanillaSymbol("\\wp ","&#8472;","wp"),LatexCmds.bot=bindVanillaSymbol("\\bot ","&#8869;","bot"),LatexCmds.clubsuit=bindVanillaSymbol("\\clubsuit ","&#9827;","club suit"),LatexCmds.diamondsuit=bindVanillaSymbol("\\diamondsuit ","&#9826;","diamond suit"),LatexCmds.heartsuit=bindVanillaSymbol("\\heartsuit ","&#9825;","heart suit"),LatexCmds.spadesuit=bindVanillaSymbol("\\spadesuit ","&#9824;","spade suit"),LatexCmds.parallelogram=bindVanillaSymbol("\\parallelogram ","&#9649;","parallelogram"),LatexCmds.square=bindVanillaSymbol("\\square ","&#11036;","square"),LatexCmds.oint=bindVanillaSymbol("\\oint ","&#8750;","o int"),LatexCmds.bigcap=bindVanillaSymbol("\\bigcap ","&#8745;","big cap"),LatexCmds.bigcup=bindVanillaSymbol("\\bigcup ","&#8746;","big cup"),LatexCmds.bigsqcup=bindVanillaSymbol("\\bigsqcup ","&#8852;","big square cup"),LatexCmds.bigvee=bindVanillaSymbol("\\bigvee ","&#8744;","big vee"),LatexCmds.bigwedge=bindVanillaSymbol("\\bigwedge ","&#8743;","big wedge"),LatexCmds.bigodot=bindVanillaSymbol("\\bigodot ","&#8857;","big o dot"),LatexCmds.bigotimes=bindVanillaSymbol("\\bigotimes ","&#8855;","big o times"),LatexCmds.bigoplus=bindVanillaSymbol("\\bigoplus ","&#8853;","big o plus"),LatexCmds.biguplus=bindVanillaSymbol("\\biguplus ","&#8846;","big u plus"),LatexCmds.lfloor=bindVanillaSymbol("\\lfloor ","&#8970;","left floor"),LatexCmds.rfloor=bindVanillaSymbol("\\rfloor ","&#8971;","right floor"),LatexCmds.lceil=bindVanillaSymbol("\\lceil ","&#8968;","left ceiling"),LatexCmds.rceil=bindVanillaSymbol("\\rceil ","&#8969;","right ceiling"),LatexCmds.opencurlybrace=LatexCmds.lbrace=bindVanillaSymbol("\\lbrace ","{","left brace"),LatexCmds.closecurlybrace=LatexCmds.rbrace=bindVanillaSymbol("\\rbrace ","}","right brace"),LatexCmds.lbrack=bindVanillaSymbol("[","left bracket"),LatexCmds.rbrack=bindVanillaSymbol("]","right bracket"),LatexCmds.slash=bindVanillaSymbol("/","slash"),LatexCmds.vert=bindVanillaSymbol("|","vertical bar"),LatexCmds.perp=LatexCmds.perpendicular=bindVanillaSymbol("\\perp ","&perp;","perpendicular"),LatexCmds.nabla=LatexCmds.del=bindVanillaSymbol("\\nabla ","&nabla;"),LatexCmds.hbar=bindVanillaSymbol("\\hbar ","&#8463;","horizontal bar"),LatexCmds.AA=LatexCmds.Angstrom=LatexCmds.angstrom=bindVanillaSymbol("\\text\\AA ","&#8491;","AA"),LatexCmds.ring=LatexCmds.circ=LatexCmds.circle=bindVanillaSymbol("\\circ ","&#8728;","circle"),LatexCmds.bull=LatexCmds.bullet=bindVanillaSymbol("\\bullet ","&bull;","bullet"),LatexCmds.setminus=LatexCmds.smallsetminus=bindVanillaSymbol("\\setminus ","&#8726;","set minus"),LatexCmds.not=LatexCmds["¬"]=LatexCmds.neg=bindVanillaSymbol("\\neg ","&not;","not"),LatexCmds["…"]=LatexCmds.dots=LatexCmds.ellip=LatexCmds.hellip=LatexCmds.ellipsis=LatexCmds.hellipsis=bindVanillaSymbol("\\dots ","&hellip;","ellipsis"),LatexCmds.converges=LatexCmds.darr=LatexCmds.dnarr=LatexCmds.dnarrow=LatexCmds.downarrow=bindVanillaSymbol("\\downarrow ","&darr;","converges with"),LatexCmds.dArr=LatexCmds.dnArr=LatexCmds.dnArrow=LatexCmds.Downarrow=bindVanillaSymbol("\\Downarrow ","&dArr;","down arrow"),LatexCmds.diverges=LatexCmds.uarr=LatexCmds.uparrow=bindVanillaSymbol("\\uparrow ","&uarr;","diverges from"),LatexCmds.uArr=LatexCmds.Uparrow=bindVanillaSymbol("\\Uparrow ","&uArr;","up arrow"),LatexCmds.rarr=LatexCmds.rightarrow=bindVanillaSymbol("\\rightarrow ","&rarr;","right arrow"),LatexCmds.implies=bindBinaryOperator("\\Rightarrow ","&rArr;","implies"),LatexCmds.rArr=LatexCmds.Rightarrow=bindVanillaSymbol("\\Rightarrow ","&rArr;","right arrow"),LatexCmds.gets=bindBinaryOperator("\\gets ","&larr;","gets"),LatexCmds.larr=LatexCmds.leftarrow=bindVanillaSymbol("\\leftarrow ","&larr;","left arrow"),LatexCmds.impliedby=bindBinaryOperator("\\Leftarrow ","&lArr;","implied by"),LatexCmds.lArr=LatexCmds.Leftarrow=bindVanillaSymbol("\\Leftarrow ","&lArr;","left arrow"),LatexCmds.harr=LatexCmds.lrarr=LatexCmds.leftrightarrow=bindVanillaSymbol("\\leftrightarrow ","&harr;","left and right arrow"),LatexCmds.iff=bindBinaryOperator("\\Leftrightarrow ","&hArr;","if and only if"),LatexCmds.hArr=LatexCmds.lrArr=LatexCmds.Leftrightarrow=bindVanillaSymbol("\\Leftrightarrow ","&hArr;","left and right arrow"),LatexCmds.Re=LatexCmds.Real=LatexCmds.real=bindVanillaSymbol("\\Re ","&real;","real"),LatexCmds.Im=LatexCmds.imag=LatexCmds.image=LatexCmds.imagin=LatexCmds.imaginary=LatexCmds.Imaginary=bindVanillaSymbol("\\Im ","&image;","imaginary"),LatexCmds.part=LatexCmds.partial=bindVanillaSymbol("\\partial ","&part;","partial"),LatexCmds.pounds=bindVanillaSymbol("\\pounds ","&pound;"),LatexCmds.alef=LatexCmds.alefsym=LatexCmds.aleph=LatexCmds.alephsym=bindVanillaSymbol("\\aleph ","&alefsym;","alef sym"),LatexCmds.xist=LatexCmds.xists=LatexCmds.exist=LatexCmds.exists=bindVanillaSymbol("\\exists ","&exist;","there exists at least 1"),LatexCmds.nexists=LatexCmds.nexist=bindVanillaSymbol("\\nexists ","&#8708;","there is no"),LatexCmds.and=LatexCmds.land=LatexCmds.wedge=bindBinaryOperator("\\wedge ","&and;","and"),LatexCmds.or=LatexCmds.lor=LatexCmds.vee=bindBinaryOperator("\\vee ","&or;","or"),LatexCmds.o=LatexCmds.O=LatexCmds.empty=LatexCmds.emptyset=LatexCmds.oslash=LatexCmds.Oslash=LatexCmds.nothing=LatexCmds.varnothing=bindBinaryOperator("\\varnothing ","&empty;","nothing"),LatexCmds.cup=LatexCmds.union=bindBinaryOperator("\\cup ","&cup;","union"),LatexCmds.cap=LatexCmds.intersect=LatexCmds.intersection=bindBinaryOperator("\\cap ","&cap;","intersection"),LatexCmds.deg=LatexCmds.degree=bindVanillaSymbol("\\degree ","&deg;","degrees"),LatexCmds.ang=LatexCmds.angle=bindVanillaSymbol("\\angle ","&ang;","angle"),LatexCmds.measuredangle=bindVanillaSymbol("\\measuredangle ","&#8737;","measured angle"),DigitGroupingChar=function(t){function s(){return null!==t&&t.apply(this,arguments)||this}return __extends(s,t),s.prototype.finalizeTree=function(t,e){this.sharedSiblingMethod(t,e)},s.prototype.siblingDeleted=function(t,e){this.sharedSiblingMethod(t,e)},s.prototype.siblingCreated=function(t,e){this.sharedSiblingMethod(t,e)},s.prototype.sharedSiblingMethod=function(t,e){e!==L&&this[R]instanceof s||this.fixDigitGrouping(t)},s.prototype.fixDigitGrouping=function(t){var e,n,r,o,i,a;if(t.enableDigitGrouping){n=e=this,r=0,o=[],i="\\ ",a=e;do{if(/^[0-9]$/.test(a.ctrlSeq))e=a;else if(a.ctrlSeq===i)e=a,r+=1;else{if("."!==a.ctrlSeq)break;e=a,o.push(a)}}while(a=e[L]);for(;a=n[R];)if(/^[0-9]$/.test(a.ctrlSeq))n=a;else if(a.ctrlSeq===i)n=a,r+=1;else{if("."!==a.ctrlSeq)break;n=a,o.push(a)}for(;n!==e&&e&&e.ctrlSeq===i;)e=e[R],--r;for(;n!==e&&n&&n.ctrlSeq===i;)n=n[L],--r;e===n&&e&&e.ctrlSeq===i||(0<r||1<o.length?this.removeGroupingBetween(e,n):o[0]?(o[0]!==e&&this.addGroupingBetween(o[0][L],e),o[0]!==n&&this.removeGroupingBetween(o[0][R],n)):this.addGroupingBetween(n,e))}},s.prototype.removeGroupingBetween=function(t,e){var n=t;do{if(n instanceof s&&n.setGroupingClass(void 0),!n||n===e)break}while(n=n[R])},s.prototype.addGroupingBetween=function(t,e){var n,r,o=t,i=0,a=0;for(o=t;o&&(a+=1,o!==e);)o=o[L];for(0===(n=a%3)&&(n=3),o=t;o&&(i+=1,r=void 0,4<=a&&(i===a?r="mq-group-leading-"+n:i%3==0&&i!==a&&(r="mq-group-start"),r=r||"mq-group-other"),o instanceof s&&o.setGroupingClass(r),o!==e);)o=o[L]},s.prototype.setGroupingClass=function(t){this._groupingClass!==t&&(this._groupingClass&&this.domFrag().removeClass(this._groupingClass),t&&this.domFrag().addClass(t),this._groupingClass=t)},s}(MQSymbol),Digit=function(o){function t(t,e){return o.call(this,t,h("span",{class:"mq-digit"},[h.text(t)]),void 0,e)||this}return __extends(t,o),t.prototype.createLeftOf=function(t){var e=t[L],n=e&&e[L],r=t.parent.parent instanceof SupSub?t.parent.parent.sub:void 0;t.options.autoSubscriptNumerals&&t.parent!==r&&(e instanceof Variable&&!1!==e.isItalic||e instanceof SupSub&&n instanceof Variable&&!1!==n.isItalic)?((new SubscriptCommand).createLeftOf(t),o.prototype.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):o.prototype.createLeftOf.call(this,t)},t.prototype.mathspeak=function(t){var e,n,r;return t&&t.createdLeftOf&&(n=(e=(t=t.createdLeftOf)[L])&&e[L],r=t.parent.parent instanceof SupSub?t.parent.parent.sub:void 0,t.options.autoSubscriptNumerals)&&t.parent!==r&&(e instanceof Variable&&!1!==e.isItalic||t[L]instanceof SupSub&&n instanceof Variable&&!1!==n.isItalic)?"Subscript "+o.prototype.mathspeak.call(this)+" Baseline":o.prototype.mathspeak.call(this)},t}(DigitGroupingChar),Variable=function(n){function e(t,e){return n.call(this,t,h("var",{},[e||h.text(t)]))||this}return __extends(e,n),e.prototype.text=function(){var t=this.ctrlSeq||"";return this.isPartOfOperator?"\\"==t[0]?t=t.slice(1,t.length):" "==t[t.length-1]&&(t=t.slice(0,-1)):(!this[L]||this[L]instanceof e||this[L]instanceof BinaryOperator||"\\ "===this[L].ctrlSeq||(t="*"+t),!this[R]||this[R]instanceof BinaryOperator||this[R]instanceof SupSub||(t+="*")),t},e.prototype.mathspeak=function(){var t=this.ctrlSeq||"";return this.isPartOfOperator||1<t.length||this.parent&&this.parent.parent&&this.parent.parent.isTextBlock()?n.prototype.mathspeak.call(this):'"'+t+'"'},e}(MQSymbol),Options.prototype.autoCommands={_maxLength:0},baseOptionProcessors.autoCommands=function(t){var e,n,r,o,i;if("string"!=typeof t||!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},o=r=0;o<e.length;o+=1){if((i=e[o]).length<2)throw'autocommand "'+i+'" not minimum length of 2';if(LatexCmds[i]===OperatorName)throw'"'+i+'" is a built-in operator name';n[i]=1,r=max(r,i.length)}return n._maxLength=r,n},Options.prototype.quietEmptyDelimiters={},baseOptionProcessors.quietEmptyDelimiters=function(t){for(var e=(t=void 0===t?"":t).split(" "),n={},r=0;r<e.length;r+=1)n[e[r]]=1;return n},Options.prototype.autoParenthesizedFunctions={_maxLength:0},baseOptionProcessors.autoParenthesizedFunctions=function(t){var e,n,r,o,i;if("string"!=typeof t||!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},o=r=0;o<e.length;o+=1){if((i=e[o]).length<2)throw'autocommand "'+i+'" not minimum length of 2';n[i]=1,r=max(r,i.length)}return n._maxLength=r,n},Letter=function(n){function x(t){var e=n.call(this,t)||this;return e.letter=t,e}return __extends(x,n),x.prototype.checkAutoCmds=function(t){var e,n,r,o,i,a;if(!this.shouldIgnoreSubstitutionInSimpleSubscript(t.options)&&0<(n=(e=t.options.autoCommands)._maxLength||0)){for(r="",o=this,i=0;o instanceof x&&o.ctrlSeq===o.letter&&i<n;)r=o.letter+r,o=o[L],i+=1;for(;r.length;){if(e.hasOwnProperty(r)){for(o=this,i=1;o&&i<r.length;i+=1,o=o[L]);return new Fragment(o,this).remove(),t[L]=o[L],(isMQNodeClass(a=LatexCmds[r])?new a(r):a(r)).createLeftOf(t)}r=r.slice(1)}}},x.prototype.autoParenthesize=function(t){var e,n,r,o,i,a,s=t.parent.getEnd(R);if(!(s&&s instanceof Bracket&&"\\left("===s.ctrlSeq||this.shouldIgnoreSubstitutionInSimpleSubscript(t.options))){for(e="",n=this,r=0,i=(o=t.options.autoParenthesizedFunctions)._maxLength||0,a=t.options.autoOperatorNames;n instanceof x&&r<i;)e=n.letter+e,n=n[L],r+=1;for(;e.length;){if(o.hasOwnProperty(e)&&a.hasOwnProperty(e))return t.parent.write(t,"(");e=e.slice(1)}}},x.prototype.createLeftOf=function(t){n.prototype.createLeftOf.call(this,t),this.checkAutoCmds(t),this.autoParenthesize(t)},x.prototype.italicize=function(t){return this.isItalic=t,this.isPartOfOperator=!t,this.domFrag().toggleClass("mq-operator-name",!t),this},x.prototype.finalizeTree=function(t,e){this.sharedSiblingMethod(t,e)},x.prototype.siblingDeleted=function(t,e){this.sharedSiblingMethod(t,e)},x.prototype.siblingCreated=function(t,e){this.sharedSiblingMethod(t,e)},x.prototype.sharedSiblingMethod=function(t,e){e!==L&&this[R]instanceof x||this.autoUnItalicize(t)},x.prototype.autoUnItalicize=function(t){var e,n,r,o,i,a,s,l,c,u,p,d,h,m,f=t.autoOperatorNames;if(0!==f._maxLength&&!this.shouldIgnoreSubstitutionInSimpleSubscript(t)){for(e=this.letter,n=this[L];n instanceof x;n=n[L])e=n.letter+e;for(r=this[R];r instanceof x;r=r[R])e+=r.letter;t=n&&n[R],o=r&&r[L],new Fragment(t||this.parent.getEnd(L),o||this.parent.getEnd(R)).each(function(t){t instanceof x&&(t.italicize(!0).domFrag().removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter)}),i=f._maxLength||0;t:for(a=0,s=n[R]||this.parent.getEnd(L);s&&a<e.length;a+=1,s=s[R])for(l=min(i,e.length-a);0<l;--l)if(h=e.slice(a,a+l),c=void 0,f.hasOwnProperty(h)){for(u=0,p=s;u<l;u+=1,p=p[R])p instanceof x&&(p.italicize(!1),c=p);d=BuiltInOpNames.hasOwnProperty(h),s.ctrlSeq=(d?"\\":"\\operatorname{")+s.ctrlSeq,c.ctrlSeq+=d?" ":"}",TwoWordOpNames.hasOwnProperty(h)&&((h=(d=c[L])&&d[L])&&h[L]).domFrag().addClass("mq-last"),this.shouldOmitPadding(s[L])||s.domFrag().addClass("mq-first"),this.shouldOmitPadding(c[R])||(c[R]instanceof SupSub?((m=c[R]).siblingCreated=m.siblingDeleted=function(){m.domFrag().toggleClass("mq-after-operator-name",!(m[R]instanceof Bracket))})():c.domFrag().toggleClass("mq-last",!(c[R]instanceof Bracket))),a+=l-1,s=c;continue t}}},x.prototype.shouldOmitPadding=function(t){return!t||"."===t.ctrlSeq||t instanceof BinaryOperator||t instanceof SummationNotation},x}(Variable),BuiltInOpNames={},Options.prototype.autoOperatorNames=defaultAutoOpNames(),TwoWordOpNames={limsup:1,liminf:1,projlim:1,injlim:1},baseOptionProcessors.autoOperatorNames=function(t){var e,n,r,o,i,a;if("string"!=typeof t)throw'"'+t+'" not a space-delimited list';if(!/^[a-z\|\-]+(?: [a-z\|\-]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of letters or "|"';for(e=t.split(" "),n={},o=r=0;o<e.length;o+=1){if((i=e[o]).length<2)throw'"'+i+'" not minimum length of 2';if(i.indexOf("|")<0)r=max(r,(n[i]=i).length);else{if(2<(a=i.split("|")).length)throw'"'+i+'" has more than 1 mathspeak delimiter';if(a[0].length<2)throw'"'+i[0]+'" not minimum length of 2';n[a[0]]=a[1].replace(/-/g," "),r=max(r,a[0].length)}}return n._maxLength=r,n},OperatorName=function(e){function t(t){return e.call(this,t||"")||this}return __extends(t,e),t.prototype.createLeftOf=function(t){for(var e=this.ctrlSeq,n=0;n<e.length;n+=1)new Letter(e.charAt(n)).createLeftOf(t)},t.prototype.parser=function(){for(var t=this.ctrlSeq,e=new MathBlock,n=0;n<t.length;n+=1)new Letter(t.charAt(n)).adopt(e,e.getEnd(R),0);return Parser.succeed(e.children())},t}(MQSymbol),Options.prototype.autoOperatorNames)Options.prototype.autoOperatorNames.hasOwnProperty(fn)&&(LatexCmds[fn]=OperatorName);function isBinaryOperator(t){var e;return!!t&&((e=t[L])?!(e instanceof BinaryOperator||/^(\\ )|[,;:\(\[]$/.test(e.ctrlSeq)):!!(t.parent&&t.parent.parent&&t.parent.parent.isStyleBlock())&&isBinaryOperator(t.parent.parent))}function getCtrlSeqsFromBlock(t){var e;return t?(e="",t.eachChild(function(t){void 0!==t.ctrlSeq&&(e+=t.ctrlSeq)}),e):""}function insLeftOfMeUnlessAtEnd(t){var e=this.parent,n=t;do{if(n[R])return t.insLeftOf(e)}while((n=n.parent.parent)!==e);t.insRightOf(e)}function getOppBracketSide(t){var e=t.side,t=t.sides[e];return{ch:OPP_BRACKS[t.ch],ctrlSeq:OPP_BRACKS[t.ctrlSeq]}}function bindCharBracketPair(t,e,n){var r,o;e=e||t,r=OPP_BRACKS[t],o=OPP_BRACKS[e],CharCmds[t]=function(){return new Bracket(L,t,r,e,o)},CharCmds[r]=function(){return new Bracket(R,t,r,e,o)},BRACKET_NAMES[t]=BRACKET_NAMES[r]=n}function TextBlockFuseChildren(t){var e,n;if(t.domFrag().oneElement().normalize(),!(e=t.domFrag().children()).isEmpty())return pray("only node in TextBlock span is Text node",3===(e=e.oneText()).nodeType),(n=new TextPiece(e.data)).setDOM(e),t.children().disown(),n.adopt(t,0,0),n}function makeTextBlock(e,n,r,o){return __extends(t,i=TextBlock),t.prototype.html=function(){var t=h(r,o,[h.text(this.textContents())]);return this.setDOM(t),NodeBase.linkElementByCmdNode(t,this),t},t;function t(){var t=null!==i&&i.apply(this,arguments)||this;return t.ctrlSeq=e,t.mathspeakTemplate=["Start"+n,"End"+n],t.ariaLabel=n,t}var i}LatexCmds.operatorname=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createLeftOf=function(){},e.prototype.numBlocks=function(){return 1},e.prototype.parser=function(){return latexMathParser.block.map(function(t){var e=!0,n="",t=t.children();return t.each(function(t){t instanceof Letter?n+=t.letter:e=!1}),e&&"ans"===n?AnsBuilder():t})},e}(MathCommand),LatexCmds.f=function(e){function t(){var t=this;return(t=e.call(this,"f")||this).letter="f",t.domView=new DOMView(0,function(){return h("var",{class:"mq-f"},[h.text("f")])}),t}return __extends(t,e),t.prototype.italicize=function(t){return this.domFrag().eachElement(function(t){return t.textContent="f"}),this.domFrag().toggleClass("mq-f",t),e.prototype.italicize.call(this,t)},t}(Letter),LatexCmds[" "]=LatexCmds.space=function(){return new DigitGroupingChar("\\ ",h("span",{},[h.text(U_NO_BREAK_SPACE)])," ")},LatexCmds["."]=function(){return new DigitGroupingChar(".",h("span",{class:"mq-digit"},[h.text(".")]),".")},LatexCmds["'"]=LatexCmds.prime=bindVanillaSymbol("'","&prime;","prime"),LatexCmds["″"]=LatexCmds.dprime=bindVanillaSymbol("″","&Prime;","double prime"),LatexCmds.backslash=bindVanillaSymbol("\\backslash ","\\","backslash"),CharCmds["\\"]||(CharCmds["\\"]=LatexCmds.backslash),LatexCmds.$=bindVanillaSymbol("\\$","$","dollar"),LatexCmds.square=bindVanillaSymbol("\\square ","□","square"),LatexCmds.mid=bindVanillaSymbol("\\mid ","∣","mid"),NonSymbolaSymbol=function(r){function t(t,e,n){return r.call(this,t,h("span",{class:"mq-nonSymbola"},[e||h.text(t)]))||this}return __extends(t,r),t}(MQSymbol),LatexCmds["@"]=function(){return new NonSymbolaSymbol("@")},LatexCmds["&"]=function(){return new NonSymbolaSymbol("\\&",h.entityText("&amp;"),"and")},LatexCmds["%"]=function(n){function t(){return n.call(this,"\\%",h.text("%"),"percent")||this}return __extends(t,n),t.prototype.parser=function(){var t=Parser.optWhitespace,e=Parser.string;return t.then(e("\\operatorname{of}").map(function(){return PercentOfBuilder()})).or(n.prototype.parser.call(this))},t}(NonSymbolaSymbol),LatexCmds["∥"]=LatexCmds.parallel=bindVanillaSymbol("\\parallel ","&#x2225;","parallel"),LatexCmds["∦"]=LatexCmds.nparallel=bindVanillaSymbol("\\nparallel ","&#x2226;","not parallel"),LatexCmds["⟂"]=LatexCmds.perp=bindVanillaSymbol("\\perp ","&#x27C2;","perpendicular"),LatexCmds.alpha=LatexCmds.beta=LatexCmds.gamma=LatexCmds.delta=LatexCmds.zeta=LatexCmds.eta=LatexCmds.theta=LatexCmds.iota=LatexCmds.kappa=LatexCmds.mu=LatexCmds.nu=LatexCmds.xi=LatexCmds.rho=LatexCmds.sigma=LatexCmds.tau=LatexCmds.chi=LatexCmds.psi=LatexCmds.omega=function(t){return new Variable("\\"+t+" ",h.entityText("&"+t+";"))},LatexCmds.phi=bindVariable("\\phi ","&#981;","phi"),LatexCmds.phiv=LatexCmds.varphi=bindVariable("\\varphi ","&phi;","phi"),LatexCmds.epsilon=bindVariable("\\epsilon ","&#1013;","epsilon"),LatexCmds.epsiv=LatexCmds.varepsilon=bindVariable("\\varepsilon ","&epsilon;","epsilon"),LatexCmds.piv=LatexCmds.varpi=bindVariable("\\varpi ","&piv;","piv"),LatexCmds.sigmaf=LatexCmds.sigmav=LatexCmds.varsigma=bindVariable("\\varsigma ","&sigmaf;","sigma"),LatexCmds.thetav=LatexCmds.vartheta=LatexCmds.thetasym=bindVariable("\\vartheta ","&thetasym;","theta"),LatexCmds.upsilon=LatexCmds.upsi=bindVariable("\\upsilon ","&upsilon;","upsilon"),LatexCmds.gammad=LatexCmds.Gammad=LatexCmds.digamma=bindVariable("\\digamma ","&#989;","gamma"),LatexCmds.kappav=LatexCmds.varkappa=bindVariable("\\varkappa ","&#1008;","kappa"),LatexCmds.rhov=LatexCmds.varrho=bindVariable("\\varrho ","&#1009;","rho"),LatexCmds.pi=LatexCmds["π"]=function(){return new NonSymbolaSymbol("\\pi ",h.entityText("&pi;"),"pi")},LatexCmds.lambda=function(){return new NonSymbolaSymbol("\\lambda ",h.entityText("&lambda;"),"lambda")},LatexCmds.Upsilon=LatexCmds.Upsi=LatexCmds.upsih=LatexCmds.Upsih=function(){return new MQSymbol("\\Upsilon ",h("var",{style:"font-family: serif"},[h.entityText("&upsih;")]),"capital upsilon")},LatexCmds.Gamma=LatexCmds.Delta=LatexCmds.Theta=LatexCmds.Lambda=LatexCmds.Xi=LatexCmds.Pi=LatexCmds.Sigma=LatexCmds.Phi=LatexCmds.Psi=LatexCmds.Omega=LatexCmds.forall=function(t){return new VanillaSymbol("\\"+t+" ",h.entityText("&"+t+";"))},LatexFragment=function(n){function t(t){var e=n.call(this)||this;return e.latexStr=t,e}return __extends(t,n),t.prototype.createLeftOf=function(t){var e,n=latexMathParser.parse(this.latexStr);n.children().adopt(t.parent,t[L],t[R]),t[L]=n.getEnd(R),domFrag(n.html()).insertBefore(t.domFrag()),n.finalizeInsert(t.options,t),(e=(e=n.getEnd(R))&&e[R])&&e.siblingCreated(t.options,L),(n=(e=n.getEnd(L))&&e[L])&&n.siblingCreated(t.options,R),t.parent.bubble(function(t){t.reflow()})},t.prototype.mathspeak=function(){return latexMathParser.parse(this.latexStr).mathspeak()},t.prototype.parser=function(){var t=latexMathParser.parse(this.latexStr).children();return Parser.succeed(t)},t}(MathCommand),LatexCmds["⁰"]=function(){return new LatexFragment("^0")},LatexCmds["¹"]=function(){return new LatexFragment("^1")},LatexCmds["²"]=function(){return new LatexFragment("^2")},LatexCmds["³"]=function(){return new LatexFragment("^3")},LatexCmds["⁴"]=function(){return new LatexFragment("^4")},LatexCmds["⁵"]=function(){return new LatexFragment("^5")},LatexCmds["⁶"]=function(){return new LatexFragment("^6")},LatexCmds["⁷"]=function(){return new LatexFragment("^7")},LatexCmds["⁸"]=function(){return new LatexFragment("^8")},LatexCmds["⁹"]=function(){return new LatexFragment("^9")},LatexCmds["¼"]=function(){return new LatexFragment("\\frac14")},LatexCmds["½"]=function(){return new LatexFragment("\\frac12")},LatexCmds["¾"]=function(){return new LatexFragment("\\frac34")},LatexCmds["√"]=function(){return new LatexFragment("\\sqrt{}")},PlusMinus=function(r){function t(t,e,n){return r.call(this,t,e,void 0,n,!0)||this}return __extends(t,r),t.prototype.contactWeld=function(t,e){this.sharedSiblingMethod(t.options,e)},t.prototype.siblingCreated=function(t,e){this.sharedSiblingMethod(t,e)},t.prototype.siblingDeleted=function(t,e){this.sharedSiblingMethod(t,e)},t.prototype.sharedSiblingMethod=function(t,e){if(e!==R)return this.domFrag().oneElement().className=isBinaryOperator(this)?"mq-binary-operator":"",this},t}(BinaryOperator),LatexCmds["+"]=function(t){function e(){return t.call(this,"+",h.text("+"))||this}return __extends(e,t),e.prototype.mathspeak=function(){return isBinaryOperator(this)?"plus":"positive"},e}(PlusMinus),MinusNode=function(t){function e(){return t.call(this,"-",h.entityText("&minus;"))||this}return __extends(e,t),e.prototype.mathspeak=function(){return isBinaryOperator(this)?"minus":"negative"},e}(PlusMinus),LatexCmds["−"]=LatexCmds["—"]=LatexCmds["–"]=LatexCmds["-"]=MinusNode,LatexCmds["±"]=LatexCmds.pm=LatexCmds.plusmn=LatexCmds.plusminus=function(){return new PlusMinus("\\pm ",h.entityText("&plusmn;"),"plus-or-minus")},LatexCmds.mp=LatexCmds.mnplus=LatexCmds.minusplus=function(){return new PlusMinus("\\mp ",h.entityText("&#8723;"),"minus-or-plus")},CharCmds["*"]=LatexCmds.sdot=LatexCmds.cdot=bindBinaryOperator("\\cdot ","&middot;","*","times"),To=function(r){function t(){return r.call(this,"\\to ",h.entityText("&rarr;"),"to")||this}return __extends(t,r),t.prototype.deleteTowards=function(t,e){var n;t===L?(n=e[L],new Fragment(n,this).remove(),e[L]=n[L],(new MinusNode).createLeftOf(e),e[L].bubble(function(t){t.reflow()})):r.prototype.deleteTowards.call(this,t,e)},t}(BinaryOperator),LatexCmds["→"]=LatexCmds.to=To,Inequality=function(o){function t(t,e){var n=this,r=e?"Strict":"";return(n=o.call(this,t["ctrlSeq".concat(r)],h.entityText(t["htmlEntity".concat(r)]),t["text".concat(r)],t["mathspeak".concat(r)])||this).data=t,n.strict=e,n}return __extends(t,o),t.prototype.swap=function(t){t=(this.strict=t)?"Strict":"";this.ctrlSeq=this.data["ctrlSeq".concat(t)],this.domFrag().children().replaceWith(domFrag(h.entityText(this.data["htmlEntity".concat(t)]))),this.textTemplate=[this.data["text".concat(t)]],this.mathspeakName=this.data["mathspeak".concat(t)]},t.prototype.deleteTowards=function(t,e){t!==L||this.strict?o.prototype.deleteTowards.call(this,t,e):(this.swap(!0),this.bubble(function(t){t.reflow()}))},t}(BinaryOperator),less={ctrlSeq:"\\le ",htmlEntity:"&le;",text:"≤",mathspeak:"less than or equal to",ctrlSeqStrict:"<",htmlEntityStrict:"&lt;",textStrict:"<",mathspeakStrict:"less than"},greater={ctrlSeq:"\\ge ",htmlEntity:"&ge;",text:"≥",mathspeak:"greater than or equal to",ctrlSeqStrict:">",htmlEntityStrict:"&gt;",textStrict:">",mathspeakStrict:"greater than"},Greater=function(n){function t(){return n.call(this,greater,!0)||this}return __extends(t,n),t.prototype.createLeftOf=function(t){var e=t[L];e instanceof BinaryOperator&&"-"===e.ctrlSeq?(t[L]=(e=e)[L],e.remove(),(new To).createLeftOf(t),t[L].bubble(function(t){t.reflow()})):n.prototype.createLeftOf.call(this,t)},t}(Inequality),LatexCmds["<"]=LatexCmds.lt=function(){return new Inequality(less,!0)},LatexCmds[">"]=LatexCmds.gt=Greater,LatexCmds["≤"]=LatexCmds.le=LatexCmds.leq=function(){return new Inequality(less,!1)},LatexCmds["≥"]=LatexCmds.ge=LatexCmds.geq=function(){return new Inequality(greater,!1)},LatexCmds.infty=LatexCmds.infin=LatexCmds.infinity=bindVanillaSymbol("\\infty ","&infin;","infinity"),LatexCmds["≠"]=LatexCmds.ne=LatexCmds.neq=bindBinaryOperator("\\ne ","&ne;","not equal"),Equality=function(n){function t(){return n.call(this,"=",h.text("="),"=","equals")||this}return __extends(t,n),t.prototype.createLeftOf=function(t){var e=t[L];e instanceof Inequality&&e.strict?(e.swap(!1),e.bubble(function(t){t.reflow()})):n.prototype.createLeftOf.call(this,t)},t}(BinaryOperator),LatexCmds["="]=Equality,LatexCmds["×"]=LatexCmds.times=LatexCmds.cross=bindBinaryOperator("\\times ","&times;","[x]","times"),LatexCmds["÷"]=LatexCmds.div=LatexCmds.divide=LatexCmds.divides=bindBinaryOperator("\\div ","&divide;","[/]","over"),Sim=function(n){function r(){return n.call(this,"\\sim ",h.text("~"),"~","tilde")||this}return __extends(r,n),r.prototype.createLeftOf=function(t){var e;t[L]instanceof r?(e=t[L],t[L]=e[L],e.remove(),(new Approx).createLeftOf(t),t[L].bubble(function(t){t.reflow()})):n.prototype.createLeftOf.call(this,t)},r}(BinaryOperator),Approx=function(r){function t(){return r.call(this,"\\approx ",h.entityText("&approx;"),"≈","approximately equal")||this}return __extends(t,r),t.prototype.deleteTowards=function(t,e){var n;t===L?(n=e[L],new Fragment(n,this).remove(),e[L]=n[L],(new Sim).createLeftOf(e),e[L].bubble(function(t){t.reflow()})):r.prototype.deleteTowards.call(this,t,e)},t}(BinaryOperator),LatexCmds.tildeNbsp=bindVanillaSymbol("~",U_NO_BREAK_SPACE," "),LatexCmds.sim=Sim,LatexCmds["≈"]=LatexCmds.approx=Approx,CharCmds["~"]=LatexCmds.sim,LatexCmds["~"]=LatexCmds.tildeNbsp,baseOptionProcessors.interpretTildeAsSim=function(t){t=!!t;return LatexCmds["~"]=t?LatexCmds.sim:LatexCmds.tildeNbsp,t},SVG_SYMBOLS={sqrt:{width:"",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"0 0 32 54"},[h("path",{d:"M0 33 L7 27 L12.5 47 L13 47 L30 0 L32 0 L13 54 L11 54 L4.5 31 L0 33"})])}},"|":{width:".4em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"0 0 10 54"},[h("path",{d:"M4.4 0 L4.4 54 L5.6 54 L5.6 0"})])}},"[":{width:".55em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"0 0 11 24"},[h("path",{d:"M8 0 L3 0 L3 24 L8 24 L8 23 L4 23 L4 1 L8 1"})])}},"]":{width:".55em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"0 0 11 24"},[h("path",{d:"M3 0 L8 0 L8 24 L3 24 L3 23 L7 23 L7 1 L3 1"})])}},"(":{width:".55em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"3 0 106 186"},[h("path",{d:"M85 0 A61 101 0 0 0 85 186 L75 186 A75 101 0 0 1 75 0"})])}},")":{width:".55em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"3 0 106 186"},[h("path",{d:"M24 0 A61 101 0 0 1 24 186 L34 186 A75 101 0 0 0 34 0"})])}},"{":{width:".7em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"10 0 210 350"},[h("path",{d:"M170 0 L170 6 A47 52 0 0 0 123 60 L123 127 A35 48 0 0 1 88 175 A35 48 0 0 1 123 223 L123 290 A47 52 0 0 0 170 344 L170 350 L160 350 A58 49 0 0 1 102 301 L103 220 A45 40 0 0 0 58 180 L58 170 A45 40 0 0 0 103 130 L103 49 A58 49 0 0 1 161 0"})])}},"}":{width:".7em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"10 0 210 350"},[h("path",{d:"M60 0 L60 6 A47 52 0 0 1 107 60 L107 127 A35 48 0 0 0 142 175 A35 48 0 0 0 107 223 L107 290 A47 52 0 0 1 60 344 L60 350 L70 350 A58 49 0 0 0 128 301 L127 220 A45 40 0 0 1 172 180 L172 170 A45 40 0 0 1 127 130 L127 49 A58 49 0 0 0 70 0"})])}},"&#8741;":{width:".7em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"0 0 10 54"},[h("path",{d:"M3.2 0 L3.2 54 L4 54 L4 0 M6.8 0 L6.8 54 L6 54 L6 0"})])}},"&lang;":{width:".55em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"0 0 10 54"},[h("path",{d:"M6.8 0 L3.2 27 L6.8 54 L7.8 54 L4.2 27 L7.8 0"})])}},"&rang;":{width:".55em",html:function(){return h("svg",{preserveAspectRatio:"none",viewBox:"0 0 10 54"},[h("path",{d:"M3.2 0 L6.8 27 L3.2 54 L2.2 54 L5.8 27 L2.2 0"})])}}},Style=function(a){function t(t,e,n,r,o){var i=a.call(this,t,new DOMView(1,function(t){return h.block(e,n,t[0])}))||this;return i.ariaLabel=r||t.replace(/^\\/,""),i.mathspeakTemplate=["Start"+i.ariaLabel+",","End"+i.ariaLabel],i.shouldNotSpeakDelimiters=o&&o.shouldNotSpeakDelimiters,i}return __extends(t,a),t.prototype.mathspeak=function(n){return!this.shouldNotSpeakDelimiters||n&&n.ignoreShorthand?a.prototype.mathspeak.call(this):this.foldChildren("",function(t,e){return t+" "+e.mathspeak(n)}).trim()},t}(MathCommand),LatexCmds.mathrm=function(t){function e(){return t.call(this,"\\mathrm","span",{class:"mq-roman mq-font"},"Roman Font",{shouldNotSpeakDelimiters:!0})||this}return __extends(e,t),e.prototype.isTextBlock=function(){return!0},e}(Style),LatexCmds.mathit=function(){return new Style("\\mathit","i",{class:"mq-font"},"Italic Font")},LatexCmds.mathbf=function(){return new Style("\\mathbf","b",{class:"mq-font"},"Bold Font")},LatexCmds.mathsf=function(){return new Style("\\mathsf","span",{class:"mq-sans-serif mq-font"},"Serif Font")},LatexCmds.mathtt=function(){return new Style("\\mathtt","span",{class:"mq-monospace mq-font"},"Math Text")},LatexCmds.underline=function(){return new Style("\\underline","span",{class:"mq-non-leaf mq-underline"},"Underline")},LatexCmds.overline=LatexCmds.bar=function(){return new Style("\\overline","span",{class:"mq-non-leaf mq-overline"},"Overline")},LatexCmds.overrightarrow=function(){return new Style("\\overrightarrow","span",{class:"mq-non-leaf mq-overarrow mq-arrow-right"},"Over Right Arrow")},LatexCmds.overleftarrow=function(){return new Style("\\overleftarrow","span",{class:"mq-non-leaf mq-overarrow mq-arrow-left"},"Over Left Arrow")},LatexCmds.overleftrightarrow=function(){return new Style("\\overleftrightarrow ","span",{class:"mq-non-leaf mq-overarrow mq-arrow-leftright"},"Over Left and Right Arrow")},LatexCmds.overarc=function(){return new Style("\\overarc","span",{class:"mq-non-leaf mq-overarc"},"Over Arc")},LatexCmds.dot=function(){return new MathCommand("\\dot",new DOMView(1,function(t){return h("span",{class:"mq-non-leaf"},[h("span",{class:"mq-dot-recurring-inner"},[h("span",{class:"mq-dot-recurring"},[h.text(U_DOT_ABOVE)]),h.block("span",{class:"mq-empty-box"},t[0])])])}))},LatexCmds.textcolor=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return __extends(t,o),t.prototype.setColor=function(e){this.color=e,this.domView=new DOMView(1,function(t){return h.block("span",{class:"mq-textcolor",style:"color:"+e},t[0])}),this.ariaLabel=e.replace(/^\\/,""),this.mathspeakTemplate=["Start "+this.ariaLabel+",","End "+this.ariaLabel]},t.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t);var e=this.blocks[0];t.latex+="\\textcolor{"+this.color+"}{",e.latexRecursive(t),t.latex+="}",this.checkCursorContextClose(t)},t.prototype.parser=function(){var e=this,t=Parser.optWhitespace,n=Parser.string,r=Parser.regex;return t.then(n("{")).then(r(/^[#\w\s.,()%-]*/)).skip(n("}")).then(function(t){return e.setColor(t),o.prototype.parser.call(e)})},t.prototype.isStyleBlock=function(){return!0},t}(MathCommand),Class=LatexCmds.class=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return __extends(t,r),t.prototype.parser=function(){var t=this,e=Parser.string,n=Parser.regex;return Parser.optWhitespace.then(e("{")).then(n(/^[-\w\s\\\xA0-\xFF]*/)).skip(e("}")).then(function(e){return t.cls=e||"",t.domView=new DOMView(1,function(t){return h.block("span",{class:"mq-class ".concat(e)},t[0])}),t.ariaLabel=e+" class",t.mathspeakTemplate=["Start "+t.ariaLabel+",","End "+t.ariaLabel],r.prototype.parser.call(t)})},t.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t);var e=this.blocks[0];t.latex+="\\class{"+this.cls+"}{",e.latexRecursive(t),t.latex+="}",this.checkCursorContextClose(t)},t.prototype.isStyleBlock=function(){return!0},t}(MathCommand),intRgx=/^[\+\-]?[\d]+$/,Options.prototype.charsThatBreakOutOfSupSub="",SupSub=function(r){function l(){var t=null!==r&&r.apply(this,arguments)||this;return t.ctrlSeq="_{...}^{...}",t}return __extends(l,r),l.prototype.setEnds=function(t){pray("SupSub ends must be MathBlocks",t[L]instanceof MathBlock&&t[R]instanceof MathBlock),this.ends=t},l.prototype.getEnd=function(t){return this.ends[t]},l.prototype.createLeftOf=function(t){if(this.replacedFragment||t[L]||!t.options.supSubsRequireOperand)return r.prototype.createLeftOf.call(this,t)},l.prototype.contactWeld=function(t){for(var e,n,r,o,i,a,s=L;s;s=s===L&&R)if(n=void 0,(e=this[s])instanceof l){for(r="sub";r;r="sub"===r&&"sup")o=this[r],i=e[r],o&&(i?o.isEmpty()?n=new Point(i,0,i.getEnd(L)):(o.domFrag().children().insAtDirEnd(-s,i.domFrag().oneElement()),a=o.children().disown(),n=new Point(i,a.getEnd(R),i.getEnd(L)),s===L?a.adopt(i,i.getEnd(R),0):a.adopt(i,0,i.getEnd(L))):e.addBlock(o.disown()),this.placeCursor=function(e,n){return function(t){t.insAtDirEnd(-s,e||n)}}(i,o));this.remove(),t&&t[L]===this&&(s===R&&n?n[L]?t.insRightOf(n[L]):t.insAtLeftEnd(n.parent):t.insRightOf(e));break}},l.prototype.finalizeTree=function(){this.getEnd(L).write=function(t,e){var n;t.options.autoSubscriptNumerals&&this===this.parent.sub&&0<="0123456789".indexOf(e)?((n=this.chToCmd(e,t.options))instanceof MQSymbol?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show()),t.controller.aria.queue("Baseline").alert(n.mathspeak({createdLeftOf:t}))):(t[L]&&!t[R]&&!t.selection&&-1<t.options.charsThatBreakOutOfSupSub.indexOf(e)&&(t.insRightOf(this.parent),t.controller.aria.queue("Baseline")),MathBlock.prototype.write.call(this,t,e))}},l.prototype.moveTowards=function(t,e,n){e.options.autoSubscriptNumerals&&!this.sup?e.insDirOf(t,this):r.prototype.moveTowards.call(this,t,e,n)},l.prototype.deleteTowards=function(t,e){var n;e.options.autoSubscriptNumerals&&this.sub?((n=this.sub.getEnd(-t))instanceof MQSymbol?n.remove():n&&n.deleteTowards(t,e.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(L,e.insAtLeftEnd(this.sub)),this.sup)&&e.insDirOf(-t,this)):r.prototype.deleteTowards.call(this,t,e)},l.prototype.latexRecursive=function(t){var e;this.checkCursorContextOpen(t),this.sub&&(t.latex+="_{",e=t.latex.length,this.sub.latexRecursive(t),e===t.latex.length&&(t.latex+=" "),t.latex+="}"),this.sup&&(t.latex+="^{",e=t.latex.length,this.sup.latexRecursive(t),e===t.latex.length&&(t.latex+=" "),t.latex+="}"),this.checkCursorContextClose(t)},l.prototype.text=function(){function t(t,e){var n=e&&e.text()||"";return e?t+(1===n.length?n:"("+(n||" ")+")"):""}return t("_",this.sub)+t("^",this.sup)},l.prototype.addBlock=function(t){"sub"===this.supsub?((this.sup=this.upInto=this.sub.upOutOf=t).adopt(this,this.sub,0).downOutOf=this.sub,t.setDOM(domFrag(h("span",{class:"mq-sup"})).append(t.domFrag().children()).prependTo(this.domFrag().oneElement()).oneElement()),NodeBase.linkElementByBlockNode(t.domFrag().oneElement(),t)):((this.sub=this.downInto=this.sup.downOutOf=t).adopt(this,0,this.sup).upOutOf=this.sup,this.domFrag().removeClass("mq-sup-only"),t.setDOM(domFrag(h("span",{class:"mq-sub"})).append(t.domFrag().children()).appendTo(this.domFrag().oneElement()).oneElement()),NodeBase.linkElementByBlockNode(t.domFrag().oneElement(),t),this.domFrag().append(domFrag(h("span",{style:"display:inline-block;width:0"},[h.text(U_ZERO_WIDTH_SPACE)]))));for(var e=0;e<2;e+=1)!function(r,o,i,a){r[o].deleteOutOf=function(t,e){var n;e.insDirOf(this[t]?-t:t,this.parent),this.isEmpty()||(n=this.getEnd(t),this.children().disown().withDirAdopt(t,e.parent,e[t],e[-t]).domFrag().insDirOf(-t,e.domFrag()),e[-t]=n),r.supsub=i,delete r[o],delete r["".concat(a,"Into")],(e=r[i])["".concat(a,"OutOf")]=insLeftOfMeUnlessAtEnd,delete e.deleteOutOf,"sub"===o&&r.domFrag().addClass("mq-sup-only").children().last().remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])},l}(MathCommand),SubscriptCommand=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.supsub="sub",t.domView=new DOMView(1,function(t){return h("span",{class:"mq-supsub mq-non-leaf"},[h.block("span",{class:"mq-sub"},t[0]),h("span",{style:"display:inline-block;width:0"},[h.text(U_ZERO_WIDTH_SPACE)])])}),t.textTemplate=["_"],t.mathspeakTemplate=["Subscript,",", Baseline"],t.ariaLabel="subscript",t}return __extends(t,e),t.prototype.finalizeTree=function(){this.downInto=this.sub=this.getEnd(L),this.sub.upOutOf=insLeftOfMeUnlessAtEnd,e.prototype.finalizeTree.call(this)},t}(SupSub),LatexCmds.subscript=LatexCmds._=SubscriptCommand,LatexCmds.superscript=LatexCmds.supscript=LatexCmds["^"]=function(r){function t(){var t=null!==r&&r.apply(this,arguments)||this;return t.supsub="sup",t.domView=new DOMView(1,function(t){return h("span",{class:"mq-supsub mq-non-leaf mq-sup-only"},[h.block("span",{class:"mq-sup"},t[0])])}),t.textTemplate=["^(",")"],t.ariaLabel="superscript",t.mathspeakTemplate=["Superscript,",", Baseline"],t}return __extends(t,r),t.prototype.mathspeak=function(t){var e,n=this.upInto;return void 0===n||(e=getCtrlSeqsFromBlock(n),t&&t.ignoreShorthand)||!intRgx.test(e)?r.prototype.mathspeak.call(this):"0"===e?"to the 0 power":"2"===e?"squared":"3"===e?"cubed":(t="",/^[+-]?\d{1,3}$/.test(e)&&(/(11|12|13|4|5|6|7|8|9|0)$/.test(e)?t="th":/1$/.test(e)?t="st":/2$/.test(e)?t="nd":/3$/.test(e)&&(t="rd")),"to the "+("object"==typeof n?n.mathspeak():e)+t+" power")},t.prototype.finalizeTree=function(){this.upInto=this.sup=this.getEnd(R),this.sup.downOutOf=insLeftOfMeUnlessAtEnd,r.prototype.finalizeTree.call(this)},t}(SupSub),SummationNotation=function(o){function t(t,e,n){var r=o.call(this)||this;return r.ariaLabel=n||t.replace(/^\\/,""),n=new DOMView(2,function(t){return h("span",{class:"mq-large-operator mq-non-leaf"},[h("span",{class:"mq-to"},[h.block("span",{},t[1])]),h("big",{},[h.text(e)]),h("span",{class:"mq-from"},[h.block("span",{},t[0])])])}),MQSymbol.prototype.setCtrlSeqHtmlTextAndMathspeak.call(r,t,n),r}return __extends(t,o),t.prototype.createLeftOf=function(t){o.prototype.createLeftOf.call(this,t),t.options.sumStartsWithNEquals&&(new Letter("n").createLeftOf(t),(new Equality).createLeftOf(t))},t.prototype.latexRecursive=function(t){var e;this.checkCursorContextOpen(t),t.latex+=this.ctrlSeq+"_{",e=t.latex.length,this.getEnd(L).latexRecursive(t),t.latex.length===e&&(t.latex+=" "),t.latex+="}^{",e=t.latex.length,this.getEnd(R).latexRecursive(t),e===t.latex.length&&(t.latex+=" "),t.latex+="}",this.checkCursorContextClose(t)},t.prototype.mathspeak=function(){return"Start "+this.ariaLabel+" from "+this.getEnd(L).mathspeak()+" to "+this.getEnd(R).mathspeak()+", end "+this.ariaLabel+", "},t.prototype.parser=function(){for(var t=Parser.string,e=Parser.optWhitespace,n=Parser.succeed,r=latexMathParser.block,o=this,i=o.blocks=[new MathBlock,new MathBlock],a=0;a<i.length;a+=1)i[a].adopt(o,o.getEnd(R),0);return e.then(t("_").or(t("^"))).then(function(t){var e=i["_"===t?0:1];return r.then(function(t){return t.children().adopt(e,e.getEnd(R),0),n(o)})}).many().result(o)},t.prototype.finalizeTree=function(){var t=this.getEnd(L),e=this.getEnd(R);t.ariaLabel="lower bound",e.ariaLabel="upper bound",this.downInto=t,this.upInto=e,(t.upOutOf=e).downOutOf=t},t}(MathCommand),LatexCmds["∑"]=LatexCmds.sum=LatexCmds.summation=function(){return new SummationNotation("\\sum ",U_NARY_SUMMATION,"sum")},LatexCmds["∏"]=LatexCmds.prod=LatexCmds.product=function(){return new SummationNotation("\\prod ",U_NARY_PRODUCT,"product")},LatexCmds.coprod=LatexCmds.coproduct=function(){return new SummationNotation("\\coprod ",U_NARY_COPRODUCT,"co product")},LatexCmds["∫"]=LatexCmds.int=LatexCmds.integral=function(e){function t(){var t=e.call(this,"\\int ","","integral")||this;return t.ariaLabel="integral",t.domView=new DOMView(2,function(t){return h("span",{class:"mq-int mq-non-leaf"},[h("big",{},[h.text(U_INTEGRAL)]),h("span",{class:"mq-supsub mq-non-leaf"},[h("span",{class:"mq-sup"},[h.block("span",{class:"mq-sup-inner"},t[1])]),h.block("span",{class:"mq-sub"},t[0]),h("span",{style:"display:inline-block;width:0"},[h.text(U_ZERO_WIDTH_SPACE)])])])}),t}return __extends(t,e),t.prototype.createLeftOf=function(t){MathCommand.prototype.createLeftOf.call(this,t)},t}(SummationNotation),Fraction=LatexCmds.frac=LatexCmds.dfrac=LatexCmds.cfrac=LatexCmds.fraction=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.ctrlSeq="\\frac",t.domView=new DOMView(2,function(t){return h("span",{class:"mq-fraction mq-non-leaf"},[h.block("span",{class:"mq-numerator"},t[0]),h.block("span",{class:"mq-denominator"},t[1]),h("span",{style:"display:inline-block;width:0"},[h.text(U_ZERO_WIDTH_SPACE)])])}),t.textTemplate=["(",")/(",")"],t}return __extends(t,a),t.prototype.finalizeTree=function(){var t=this.getEnd(L),e=this.getEnd(R);this.upInto=e.upOutOf=t,this.downInto=t.downOutOf=e,t.ariaLabel="numerator",e.ariaLabel="denominator",1<this.getFracDepth()?this.mathspeakTemplate=["StartNestedFraction,","NestedOver",", EndNestedFraction"]:this.mathspeakTemplate=["StartFraction,","Over",", EndFraction"]},t.prototype.mathspeak=function(t){var e,n,r,o,i;if(t&&t.createdLeftOf)return t.createdLeftOf.parent.mathspeak();if(r=getCtrlSeqsFromBlock(this.getEnd(L)),e=getCtrlSeqsFromBlock(this.getEnd(R)),t&&t.ignoreShorthand||!intRgx.test(r)||!intRgx.test(e)||(t="1"===r||"-1"===r,n="","2"===e?n=t?"half":"halves":"3"===e?n=t?"third":"thirds":"4"===e?n=t?"quarter":"quarters":"5"===e?n=t?"fifth":"fifths":"6"===e?n=t?"sixth":"sixths":"7"===e?n=t?"seventh":"sevenths":"8"===e?n=t?"eighth":"eighths":"9"===e&&(n=t?"ninth":"ninths"),""===n))return a.prototype.mathspeak.call(this);for(r="",o=!1,i=this[L];i&&void 0!==i[L];i=i[L])if("\\ "!==i.ctrlSeq){if(!intRgx.test(i.ctrlSeq||"")){o=!1;break}o=!0}return o&&(r+="and "),r+=this.getEnd(L).mathspeak()+" "+n},t.prototype.getFracDepth=function(){var n=function(t,e){return t instanceof MQNode&&t.ctrlSeq&&0<=t.ctrlSeq.toLowerCase().search("frac")&&(e+=1),t&&t.parent?n(t.parent,e):e};return n(this,0)},t}(MathCommand),LiveFraction=LatexCmds.over=CharCmds["/"]=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return __extends(t,o),t.prototype.createLeftOf=function(t){var e,n,r;if(!this.replacedFragment){if(e=t[L],!t.options.typingSlashCreatesNewFraction)for(;e&&!(e instanceof BinaryOperator||e instanceof(LatexCmds.text||noop)||e instanceof SummationNotation||"\\ "===e.ctrlSeq||/^[,;:]$/.test(e.ctrlSeq));)e=e[L];(e=e instanceof SummationNotation&&e[R]instanceof SupSub&&(n=(e=e[R])[R])instanceof SupSub&&n.ctrlSeq!=e.ctrlSeq?e[R]:e)===t[L]||t.isTooDeep(1)||(n=e[R],r=t[L],this.replaces(new Fragment(n||t.parent.getEnd(L),r)),t[L]=e)}o.prototype.createLeftOf.call(this,t)},t}(Fraction),AnsBuilder=function(){return new MQSymbol("\\operatorname{ans}",h("span",{class:"mq-ans"},[h.text("ans")]),"ans")},LatexCmds.ans=AnsBuilder,PercentOfBuilder=function(){return new MQSymbol("\\%\\operatorname{of}",h("span",{class:"mq-nonSymbola mq-operator-name"},[h.text("% of ")]),"percent of")},LatexCmds.percent=LatexCmds.percentof=PercentOfBuilder,Token=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tokenId="",t.ctrlSeq="\\token",t.textTemplate=["token(",")"],t.mathspeakTemplate=["StartToken,",", EndToken"],t.ariaLabel="token",t}return __extends(t,e),t.prototype.html=function(){var t=h("span",{class:"mq-token mq-ignore-mousedown","data-mq-token":this.tokenId});return this.setDOM(t),NodeBase.linkElementByCmdNode(t,this),t},t.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t),t.latex+="\\token{"+this.tokenId+"}",this.checkCursorContextClose(t)},t.prototype.mathspeak=function(){var e=[];return this.domFrag().children().eachElement(function(t){t=t.getAttribute("aria-label");"string"==typeof t&&""!==t&&e.push(t)}),0<e.length?e.join(" ").trim():"token "+this.tokenId},t.prototype.parser=function(){var n=this;return latexMathParser.block.map(function(t){var e=t.getEnd(L);if(e)for(n.tokenId+=e.ctrlSeq;e=e[R];)n.tokenId+=e.ctrlSeq;return n})},t}(MQSymbol),LatexCmds.token=Token,SquareRoot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ctrlSeq="\\sqrt",t.domView=new DOMView(1,function(t){return h("span",{class:"mq-non-leaf mq-sqrt-container"},[h("span",{class:"mq-scaled mq-sqrt-prefix"},[SVG_SYMBOLS.sqrt.html()]),h.block("span",{class:"mq-non-leaf mq-sqrt-stem"},t[0])])}),t.textTemplate=["sqrt(",")"],t.mathspeakTemplate=["StartRoot,",", EndRoot"],t.ariaLabel="root",t}return __extends(t,e),t.prototype.parser=function(){return latexMathParser.optBlock.then(function(n){return latexMathParser.block.map(function(t){var e=new NthRoot;return e.blocks=[n,t],n.adopt(e,0,0),t.adopt(e,n,0),e})}).or(e.prototype.parser.call(this))},t}(MathCommand),LatexCmds.sqrt=SquareRoot,LatexCmds.hat=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ctrlSeq="\\hat",t.domView=new DOMView(1,function(t){return h("span",{class:"mq-non-leaf"},[h("span",{class:"mq-hat-prefix"},[h.text("^")]),h.block("span",{class:"mq-hat-stem"},t[0])])}),t.textTemplate=["hat(",")"],t}return __extends(t,e),t}(MathCommand),NthRoot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.domView=new DOMView(2,function(t){return h("span",{class:"mq-nthroot-container mq-non-leaf"},[h.block("sup",{class:"mq-nthroot mq-non-leaf"},t[0]),h("span",{class:"mq-scaled mq-sqrt-container"},[h("span",{class:"mq-sqrt-prefix mq-scaled"},[SVG_SYMBOLS.sqrt.html()]),h.block("span",{class:"mq-sqrt-stem mq-non-leaf"},t[1])])])}),t.textTemplate=["sqrt[","](",")"],t}return __extends(t,e),t.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t),t.latex+="\\sqrt[",this.getEnd(L).latexRecursive(t),t.latex+="]{",this.getEnd(R).latexRecursive(t),t.latex+="}",this.checkCursorContextClose(t)},t.prototype.mathspeak=function(){var t=this.getEnd(L).mathspeak(),e=this.getEnd(R).mathspeak();return this.getEnd(L).ariaLabel="Index",this.getEnd(R).ariaLabel="Radicand","3"===t?"Start Cube Root, "+e+", End Cube Root":"Root Index "+t+", Start Root, "+e+", End Root"},t}(SquareRoot),LatexCmds.nthroot=NthRoot,LatexCmds.cbrt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createLeftOf=function(t){e.prototype.createLeftOf.call(this,t),new Digit("3").createLeftOf(t),t.controller.moveRight()},t}(NthRoot),DiacriticAbove=function(o){function t(t,e,n){var r=new DOMView(1,function(t){return h("span",{class:"mq-non-leaf"},[h("span",{class:"mq-diacritic-above"},[e]),h.block("span",{class:"mq-diacritic-stem"},t[0])])});return o.call(this,t,r,n)||this}return __extends(t,o),t}(MathCommand),LatexCmds.vec=function(){return new DiacriticAbove("\\vec",h.entityText("&rarr;"),["vec(",")"])},LatexCmds.tilde=function(){return new DiacriticAbove("\\tilde",h.text("~"),["tilde(",")"])},DelimsNode=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.setDOM=function(t){var e;return n.prototype.setDOM.call(this,t),(t=this.domFrag().children()).isEmpty()||(this.delimFrags=((e={})[L]=t.first(),e[R]=t.last(),e)),this},t}(MathCommand),Bracket=function(a){function r(t,e,n,r,o){var i=a.call(this,"\\left"+r,void 0,[e,n])||this;return i.side=t,i.sides=((t={})[L]={ch:e,ctrlSeq:r},t[R]={ch:n,ctrlSeq:o},t),i}return __extends(r,a),r.prototype.numBlocks=function(){return 1},r.prototype.html=function(){var e=this,n=this.getSymbol(L),r=this.getSymbol(R);return this.domView=new DOMView(1,function(t){return h("span",{class:"mq-non-leaf mq-bracket-container"},[h("span",{style:"width:"+n.width,class:"mq-scaled mq-bracket-l mq-paren"+(e.side===R?" mq-ghost":"")},[n.html()]),h.block("span",{style:"margin-left:"+n.width+";margin-right:"+r.width,class:"mq-bracket-middle mq-non-leaf"},t[0]),h("span",{style:"width:"+r.width,class:"mq-scaled mq-bracket-r mq-paren"+(e.side===L?" mq-ghost":"")},[r.html()])])}),a.prototype.html.call(this)},r.prototype.getSymbol=function(t){t=this.sides[t||R].ch;return SVG_SYMBOLS[t]||{width:"0",html:""}},r.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t),t.latex+="\\left"+this.sides[L].ctrlSeq,this.getEnd(L).latexRecursive(t),t.latex+="\\right"+this.sides[R].ctrlSeq,this.checkCursorContextClose(t)},r.prototype.mathspeak=function(t){var e=this.sides[L].ch,n=this.sides[R].ch;if("|"===e&&"|"===n)this.mathspeakTemplate=["StartAbsoluteValue,",", EndAbsoluteValue"],this.ariaLabel="absolute value";else{if(t&&t.createdLeftOf&&this.side)return t="",this.side===L?t=this.textTemplate[0]:this.side===R&&(t=this.textTemplate[1]),(this.side===L?"left ":"right ")+BRACKET_NAMES[t];this.mathspeakTemplate=["left "+BRACKET_NAMES[e]+",",", right "+BRACKET_NAMES[n]],this.ariaLabel=BRACKET_NAMES[e]+" block"}return a.prototype.mathspeak.call(this)},r.prototype.matchBrack=function(t,e,n){return n instanceof r&&n.side&&n.side!==-e&&(!t.restrictMismatchedBrackets||OPP_BRACKS[this.sides[this.side].ch]===n.sides[n.side].ch||{"(":"]","[":")"}[this.sides[L].ch]===n.sides[R].ch)&&n},r.prototype.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side];t=t.delimFrags[this.side===L?L:R].removeClass("mq-ghost");this.replaceBracket(t,this.side)},r.prototype.createLeftOf=function(t){var e,n;this.replacedFragment||(e=t.options,e="|"===this.sides[L].ch?this.matchBrack(e,R,t[R])||this.matchBrack(e,L,t[L])||this.matchBrack(e,0,t.parent.parent):this.matchBrack(e,-this.side,t[-this.side])||this.matchBrack(e,-this.side,t.parent.parent)),e?(n=this.side=-e.side,this.closeOpposing(e),e===t.parent.parent&&t[n]&&new Fragment(t[n],t.parent.getEnd(n),-n).disown().withDirAdopt(-n,e.parent,e,e[n]).domFrag().insDirOf(n,e.domFrag()),e.bubble(function(t){t.reflow()})):(n=(e=this).side,e.replacedFragment?e.side=0:t[-n]&&(e.replaces(new Fragment(t[-n],t.parent.getEnd(-n),n)),t[-n]=0),a.prototype.createLeftOf.call(this,t)),n===L?t.insAtLeftEnd(e.getEnd(L)):t.insRightOf(e)},r.prototype.placeCursor=function(){},r.prototype.unwrap=function(){this.getEnd(L).children().disown().adopt(this.parent,this,this[R]).domFrag().insertAfter(this.domFrag()),this.remove()},r.prototype.deleteSide=function(t,e,n){var r,o,i,a=this.parent,s=this[t],l=a.getEnd(t);if(t===this.side)this.unwrap(),s?n.insDirOf(-t,s):n.insAtDirEnd(t,a);else if(o=n.options,i=!this.side,this.side=-t,this.matchBrack(o,t,this.getEnd(L).getEnd(this.side)))this.closeOpposing(this.getEnd(L).getEnd(this.side)),r=this.getEnd(L).getEnd(t),this.unwrap(),r&&r.siblingCreated(n.options,t),s?n.insDirOf(-t,s):n.insAtDirEnd(t,a);else{if(this.matchBrack(o,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&i)return this.unwrap(),void(s?n.insDirOf(-t,s):n.insAtDirEnd(t,a));this.sides[t]=getOppBracketSide(this),this.delimFrags[L].removeClass("mq-ghost"),this.delimFrags[R].removeClass("mq-ghost"),o=this.delimFrags[t].addClass("mq-ghost"),this.replaceBracket(o,t)}s?(r=(i=this.getEnd(L)).getEnd(t),i.domFrag().removeClass("mq-empty"),new Fragment(s,l,-t).disown().withDirAdopt(-t,i,r,0).domFrag().insAtDirEnd(t,i.domFrag().oneElement()),r&&r.siblingCreated(n.options,t),n.insDirOf(-t,s)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.getEnd(L))}},r.prototype.replaceBracket=function(t,e){var n=this.getSymbol(e);t.children().replaceWith(domFrag(n.html())),t.oneElement().style.width=n.width,e===L?(e=t.next()).isEmpty()||(e.oneElement().style.marginLeft=n.width):(e=t.prev()).isEmpty()||(e.oneElement().style.marginRight=n.width)},r.prototype.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},r.prototype.finalizeTree=function(){this.getEnd(L).deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimFrags[this.side===L?R:L].removeClass("mq-ghost"),this.side=0}},r.prototype.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()},r}(DelimsNode),OPP_BRACKS={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},BRACKET_NAMES={"&lang;":"angle-bracket","&rang;":"angle-bracket","|":"pipe"},bindCharBracketPair("(","","parenthesis"),bindCharBracketPair("[","","bracket"),bindCharBracketPair("{","\\{","brace"),LatexCmds.langle=function(){return new Bracket(L,"&lang;","&rang;","\\langle ","\\rangle ")},LatexCmds.rangle=function(){return new Bracket(R,"&lang;","&rang;","\\langle ","\\rangle ")},CharCmds["|"]=function(){return new Bracket(L,"|","|","|","|")},LatexCmds.lVert=function(){return new Bracket(L,"&#8741;","&#8741;","\\lVert ","\\rVert ")},LatexCmds.rVert=function(){return new Bracket(R,"&#8741;","&#8741;","\\lVert ","\\rVert ")},LatexCmds.left=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parser=function(){var t=Parser.regex,e=Parser.string,i=Parser.optWhitespace;return i.then(t(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then(function(r){var o=r.replace(/^\\/,"");return"\\langle"==r&&(o="&lang;",r+=" "),"\\lVert"==r&&(o="&#8741;",r+=" "),latexMathParser.then(function(n){return e("\\right").skip(i).then(t(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map(function(t){var e=t.replace(/^\\/,"");return"\\rangle"==t&&(e="&rang;",t+=" "),"\\rVert"==t&&(e="&#8741;",t+=" "),(e=new Bracket(0,o,e,r,t)).blocks=[n],n.adopt(e,0,0),e})})})},e}(MathCommand),LatexCmds.right=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parser=function(){return Parser.fail("unmatched \\right")},e}(MathCommand),leftBinomialSymbol=SVG_SYMBOLS["("],rightBinomialSymbol=SVG_SYMBOLS[")"],Binomial=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ctrlSeq="\\binom",t.domView=new DOMView(2,function(t){return h("span",{class:"mq-non-leaf mq-bracket-container"},[h("span",{style:"width:"+leftBinomialSymbol.width,class:"mq-paren mq-bracket-l mq-scaled"},[leftBinomialSymbol.html()]),h("span",{style:"margin-left:"+leftBinomialSymbol.width+"; margin-right:"+rightBinomialSymbol.width,class:"mq-non-leaf mq-bracket-middle"},[h("span",{class:"mq-array mq-non-leaf"},[h.block("span",{},t[0]),h.block("span",{},t[1])])]),h("span",{style:"width:"+rightBinomialSymbol.width,class:"mq-paren mq-bracket-r mq-scaled"},[rightBinomialSymbol.html()])])}),t.textTemplate=["choose(",",",")"],t.mathspeakTemplate=["StartBinomial,","Choose",", EndBinomial"],t.ariaLabel="binomial",t}return __extends(t,e),t}(DelimsNode),LatexCmds.binom=LatexCmds.binomial=Binomial,LatexCmds.choose=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createLeftOf=function(t){LiveFraction.prototype.createLeftOf(t)},e}(Binomial),MathFieldNode=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.ctrlSeq="\\MathQuillMathField",t.domView=new DOMView(1,function(t){return h("span",{class:"mq-editable-field"},[h.block("span",{class:"mq-root-block","aria-hidden":"true"},t[0])])}),t}return __extends(t,o),t.prototype.parser=function(){var e=this,t=Parser.string,n=Parser.regex,r=Parser.succeed;return t("[").then(n(/^[a-z][a-z0-9]*/i)).skip(t("]")).map(function(t){e.name=t}).or(r(void 0)).then(o.prototype.parser.call(this))},t.prototype.finalizeTree=function(t){t=new Controller(this.getEnd(L),this.domFrag().oneElement(),t);t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),RootBlockMixin(t.root),function t(e){var n;e.parentNode&&!domFrag(e).hasClass("mq-root-block")&&t(e.parentNode),e.nodeType===Node.ELEMENT_NODE&&"true"===(n=e).getAttribute("aria-hidden")&&(n.removeAttribute("aria-hidden"),domFrag(e).children().eachElement(function(t){t.setAttribute("aria-hidden","true")}))}(this.domFrag().parent().oneElement()),this.domFrag().oneElement().removeAttribute("aria-hidden")},t.prototype.registerInnerField=function(t,e){e=new e(this.getEnd(L).controller);t[this.name]=e,t.push(e)},t.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t),this.getEnd(L).latexRecursive(t),this.checkCursorContextClose(t)},t.prototype.text=function(){return this.getEnd(L).text()},t}(MathCommand),LatexCmds.editable=LatexCmds.MathQuillMathField=MathFieldNode,EmbedNode=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.domView=new DOMView(0,function(){return h("span",{},[parseHTML(t.htmlString||"")])}),this.latex=t.latex||e,this},e.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t),t.latex+=this.latex(),this.checkCursorContextClose(t)},e.prototype.parser=function(){var n=this,t=Parser.string,r=Parser.regex,o=Parser.succeed;return t("{").then(r(/^[a-z][a-z0-9]*/i)).skip(t("}")).then(function(e){return t("[").then(r(/^[-\w\s]*/)).skip(t("]")).or(o(void 0)).map(function(t){return n.setOptions(EMBEDS[e](t))})})},e}(MQSymbol),LatexCmds.embed=EmbedNode,TextBlock=function(o){function i(){var t=null!==o&&o.apply(this,arguments)||this;return t.ctrlSeq="\\text",t.ariaLabel="Text",t.mathspeakTemplate=["StartText","EndText"],t}return __extends(i,o),i.prototype.replaces=function(t){t instanceof Fragment?this.replacedText=t.remove().domFrag().text():"string"==typeof t&&(this.replacedText=t)},i.prototype.setDOMFrag=function(t){var e;return o.prototype.setDOM.call(this,t),(t=this.getEnd(L))&&!(e=this.domFrag().children()).isEmpty()&&t.setDOM(e.oneText()),this},i.prototype.createLeftOf=function(t){var e,n,r=this;if(o.prototype.createLeftOf.call(this,t),t.insAtRightEnd(r),r.replacedText)for(e=0;e<r.replacedText.length;e+=1)r.write(t,r.replacedText.charAt(e));(n=r[R])&&n.siblingCreated(t.options,L),(n=r[L])&&n.siblingCreated(t.options,R),r.bubble(function(t){t.reflow()})},i.prototype.parser=function(){var e=this,t=Parser.string,n=Parser.regex;return Parser.optWhitespace.then(t("{")).then(n(/^[^}]*/)).skip(t("}")).map(function(t){return 0===t.length?new Fragment(0,0):(new TextPiece(t).adopt(e,0,0),e)})},i.prototype.textContents=function(){return this.foldChildren("",function(t,e){return t+e.textStr})},i.prototype.text=function(){return'"'+this.textContents()+'"'},i.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t);var e=this.textContents();0<e.length&&(t.latex+=this.ctrlSeq+"{",t.latex+=e.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&"),t.latex+="}"),this.checkCursorContextClose(t)},i.prototype.html=function(){var t=h("span",{class:"mq-text-mode"},[h.text(this.textContents())]);return this.setDOM(t),NodeBase.linkElementByCmdNode(t,this),t},i.prototype.mathspeak=function(t){return t&&t.ignoreShorthand?this.mathspeakTemplate[0]+", "+this.textContents()+", "+this.mathspeakTemplate[1]:this.textContents()},i.prototype.isTextBlock=function(){return!0},i.prototype.moveTowards=function(t,e){e.insAtDirEnd(-t,this),e.controller.aria.queueDirEndOf(-t).queue(e.parent,!0)},i.prototype.moveOutOf=function(t,e){e.insDirOf(t,this),e.controller.aria.queueDirOf(t).queue(this)},i.prototype.unselectInto=function(t,e){this.moveTowards(t,e)},i.prototype.selectTowards=function(t,e){MathCommand.prototype.selectTowards.call(this,t,e)},i.prototype.deleteTowards=function(t,e){MathCommand.prototype.deleteTowards.call(this,t,e)},i.prototype.selectOutOf=function(t,e){e.insDirOf(t,this)},i.prototype.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},i.prototype.write=function(t,e){var n,r;t.show().deleteSelection(),"$"!==e?(n=t[L])?n instanceof TextPiece&&n.appendText(e):new TextPiece(e).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),new VanillaSymbol("\\$",h.text("$")).createLeftOf(t)):t[R]?t[L]?(n=new i,(r=this.getEnd(L))&&(r.disown().domFrag().detach(),r.adopt(n,0,0)),t.insLeftOf(this),o.prototype.createLeftOf.call(n,t)):t.insLeftOf(this):t.insRightOf(this),this.bubble(function(t){t.reflow()}),t.controller.aria.alert(e)},i.prototype.writeLatex=function(t,e){var n=t[L];n?n instanceof TextPiece&&n.appendText(e):new TextPiece(e).createLeftOf(t),this.bubble(function(t){t.reflow()})},i.prototype.seek=function(t,e){var n,r,o,i,a,s,l,c;if(e.hide(),n=TextBlockFuseChildren(this)){for(l=this.domFrag().children().oneText(),(r=document.createRange()).selectNodeContents(l),1!==(l=r.getClientRects()).length||(l=(r=l[0]).width,r=r.left,l=l/this.textContents().length,(r=Math.round((t-r)/l))<=0)?e.insAtLeftEnd(this):r>=n.textStr.length?e.insAtRightEnd(this):e.insLeftOf(n.splitRight(r)),a=i=(o=t-e.show().getBoundingClientRectWithoutMargin().left)&&o<0?L:R;e[i]&&0<o*a;)e[i].moveTowards(i,e),a=o,o=t-e.getBoundingClientRectWithoutMargin().left;i*o<-i*a&&e[-i].moveTowards(-i,e),e.anticursor?e.anticursor.parent===this&&(l=(s=e[L])&&s.textStr.length,this.anticursorPosition===l?e.anticursor=Anticursor.fromCursor(e):(this.anticursorPosition<l?(c=s.splitRight(this.anticursorPosition),e[L]=c):c=e[R].splitRight(this.anticursorPosition-l),e.anticursor=new Anticursor(this,c[L],c))):(s=e[L],this.anticursorPosition=s&&s.textStr.length)}},i.prototype.blur=function(t){MathBlock.prototype.blur.call(this,t),t&&(""===this.textContents()?(this.remove(),t[L]===this?t[L]=this[L]:t[R]===this&&(t[R]=this[R])):TextBlockFuseChildren(this))},i.prototype.focus=function(){MathBlock.prototype.focus.call(this)},i}(MQNode),TextPiece=function(n){function a(t){var e=n.call(this)||this;return e.textStr=t,e}return __extends(a,n),a.prototype.html=function(){var t=h.text(this.textStr);return this.setDOM(t),t},a.prototype.appendText=function(t){this.textStr+=t,this.domFrag().oneText().appendData(t)},a.prototype.prependText=function(t){this.textStr=t+this.textStr,this.domFrag().oneText().insertData(0,t)},a.prototype.insTextAtDirEnd=function(t,e){prayDirection(e),e===R?this.appendText(t):this.prependText(t)},a.prototype.splitRight=function(t){var e=new a(this.textStr.slice(t)).adopt(this.parent,this,this[R]);return e.setDOM(this.domFrag().oneText().splitText(t)),this.textStr=this.textStr.slice(0,t),e},a.prototype.endChar=function(t,e){return e.charAt(t===L?0:-1+e.length)},a.prototype.moveTowards=function(t,e){var n,r;return prayDirection(t),n=this.endChar(-t,this.textStr),(r=this[-t])instanceof a?r.insTextAtDirEnd(n,t):new a(n).createDir(-t,e),this.deleteTowards(t,e)},a.prototype.mathspeak=function(){return this.textStr},a.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t),t.latex+=this.textStr,this.checkCursorContextClose(t)},a.prototype.deleteTowards=function(t,e){var n;1<this.textStr.length?(t===R?(this.domFrag().oneText().deleteData(0,1),n=this.textStr[0],this.textStr=this.textStr.slice(1)):(this.domFrag().oneText().deleteData(-1+this.textStr.length,1),n=this.textStr[this.textStr.length-1],this.textStr=this.textStr.slice(0,-1)),e.controller.aria.queue(n)):(this.remove(),e[t]=this[t],e.controller.aria.queue(this.textStr))},a.prototype.selectTowards=function(t,e){var n,r,o,i;if(prayDirection(t),n=e.anticursor)return r=this.endChar(-t,this.textStr),n[t]===this?(o=new a(r).createDir(t,e),n[t]=o,e.insDirOf(t,o)):((i=this[-t])instanceof a?i.insTextAtDirEnd(r,t):(o=new a(r).createDir(-t,e),(i=e.selection)&&o.domFrag().insDirOf(-t,i.domFrag())),1===this.textStr.length&&n[-t]===this&&(n[-t]=this[-t])),this.deleteTowards(t,e)},a}(MQNode),LatexCmds.text=LatexCmds.textnormal=LatexCmds.textrm=LatexCmds.textup=LatexCmds.textmd=TextBlock,LatexCmds.em=LatexCmds.italic=LatexCmds.italics=LatexCmds.emph=LatexCmds.textit=LatexCmds.textsl=makeTextBlock("\\textit","Italic","i",{class:"mq-text-mode"}),LatexCmds.strong=LatexCmds.bold=LatexCmds.textbf=makeTextBlock("\\textbf","Bold","b",{class:"mq-text-mode"}),LatexCmds.sf=LatexCmds.textsf=makeTextBlock("\\textsf","Sans serif font","span",{class:"mq-sans-serif mq-text-mode"}),LatexCmds.tt=LatexCmds.texttt=makeTextBlock("\\texttt","Mono space font","span",{class:"mq-monospace mq-text-mode"}),LatexCmds.textsc=makeTextBlock("\\textsc","Variable font","span",{style:"font-variant:small-caps",class:"mq-text-mode"}),LatexCmds.uppercase=makeTextBlock("\\uppercase","Uppercase","span",{style:"text-transform:uppercase",class:"mq-text-mode"}),LatexCmds.lowercase=makeTextBlock("\\lowercase","Lowercase","span",{style:"text-transform:lowercase",class:"mq-text-mode"}),RootMathCommand=function(n){function t(t){var e=n.call(this,"$")||this;return e.domView=new DOMView(1,function(t){return h.block("span",{class:"mq-math-mode"},t[0])}),e.cursor=t,e}return __extends(t,n),t.prototype.createBlocks=function(){n.prototype.createBlocks.call(this);var t=this.getEnd(L);t.cursor=this.cursor,t.write=function(t,e){"$"!==e?MathBlock.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(void 0,t),new VanillaSymbol("\\$",h.text("$")).createLeftOf(t.show())):t[R]?t[L]?MathBlock.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t),t.latex+="$",this.getEnd(L).latexRecursive(t),t.latex+="$",this.checkCursorContextClose(t)},t}(MathCommand),RootTextBlock=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return __extends(t,r),t.prototype.keystroke=function(t,e,n){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return r.prototype.keystroke.call(this,t,e,n)},t.prototype.write=function(t,e){var n;t.show().deleteSelection(),("$"===e?new RootMathCommand(t):("<"===e?n=h.entityText("&lt;"):">"===e&&(n=h.entityText("&gt;")),new VanillaSymbol(e,n))).createLeftOf(t)},t}(RootMathBlock),API.TextField=function(t){var e;return e=t.EditableField,__extends(n,e),n.prototype.__mathquillify=function(){return e.prototype.mathquillify.call(this,"mq-editable-field mq-text-mode"),this},n.prototype.latex=function(t){return t?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},(t=n).RootBlock=RootTextBlock,t;function n(){return null!==e&&e.apply(this,arguments)||this}},CharCmds["\\"]=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.ctrlSeq="\\",t.domView=new DOMView(1,function(t){return h("span",{class:"mq-latex-command-input-wrapper mq-non-leaf"},[h("span",{class:"mq-latex-command-input mq-non-leaf"},[h.text("\\"),h.block("span",{},t[0])])])}),t.textTemplate=["\\"],t}return __extends(t,o),t.prototype.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.prototype.createBlocks=function(){var t,r;o.prototype.createBlocks.call(this),(t=this.getEnd(L)).focus=function(){return this.parent.domFrag().addClass("mq-hasCursor"),this.isEmpty()&&this.parent.domFrag().removeClass("mq-empty"),this},t.blur=function(){return this.parent.domFrag().removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.domFrag().addClass("mq-empty"),this},t.write=function(t,e){var n;t.show().deleteSelection(),e.match(/[a-z]/i)?(new VanillaSymbol(e).createLeftOf(t),t.controller.aria.alert(e)):(n=this.parent.renderCommand(t),t.controller.aria.queue(n.mathspeak({createdLeftOf:t})),"\\"===e&&this.isEmpty()?t.controller.aria.alert():t.parent.write(t,e))},r=t.keystroke,t.keystroke=function(t,e,n){if("Tab"!==t&&"Enter"!==t&&"Spacebar"!==t)return r.call(this,t,e,n);t=this.parent.renderCommand(n.cursor),n.aria.alert(t.mathspeak({createdLeftOf:n.cursor})),null!=e&&e.preventDefault()}},t.prototype.createLeftOf=function(t){var e,n;o.prototype.createLeftOf.call(this,t),this._replacedFragment&&(t=this.domFrag(),e=t.oneElement(),this._replacedFragment.domFrag().addClass("mq-blur"),e.addEventListener("mousedown",n=function(t){return(t.target=e).dispatchEvent(t),!1}),e.addEventListener("mouseup",n),this._replacedFragment.domFrag().insertBefore(t.children().first()))},t.prototype.latexRecursive=function(t){this.checkCursorContextOpen(t),t.latex+="\\",this.getEnd(L).latexRecursive(t),t.latex+=" ",this.checkCursorContextClose(t)},t.prototype.renderCommand=function(t){var e,n,r;return this.setDOM(this.domFrag().children().lastElement()),this.remove(),this[R]?t.insLeftOf(this[R]):t.insAtRightEnd(this.parent),e=this.getEnd(L).latex(),(n=LatexCmds[e=e||" "])?(r=void 0,r=isMQNodeClass(n)?new n(e):n(e),this._replacedFragment&&r.replaces(this._replacedFragment),r.createLeftOf(t)):((r=new TextBlock).replaces(e),r.createLeftOf(t),t.insRightOf(r),this._replacedFragment&&this._replacedFragment.remove()),r},t}(MathCommand),module.exports=MathQuill;
